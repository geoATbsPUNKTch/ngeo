webpackJsonp([0],{3:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(4);const r=function(e){const t=e||{};let i;i=void 0!==t.attributions?t.attributions:[r.ATTRIBUTION];const n=void 0!==t.crossOrigin?t.crossOrigin:"anonymous",a=void 0!==t.url?t.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";o.a.call(this,{attributions:i,cacheSize:t.cacheSize,crossOrigin:n,opaque:void 0===t.opaque||t.opaque,maxZoom:void 0!==t.maxZoom?t.maxZoom:19,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,url:a,wrapX:t.wrapX})};Object(n.inherits)(r,o.a),r.ATTRIBUTION='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.',t.default=r},373:function(e,t,i){i(7),e.exports=i(374)},374:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(i(9)),o=c(i(14)),r=c(i(13)),a=c(i(3)),s=c(i(375)),l=(c(i(!function(){var e=new Error('Cannot find module "ngeo/index.js"');throw e.code="MODULE_NOT_FOUND",e}())),c(i(12))),u=c(i(379));function c(e){return e&&e.__esModule?e:{default:e}}var d={};d.module=angular.module("app",[l.default.name,s.default.name]),d.MainController=function(e,t){this.map=new n.default({layers:[new r.default({source:new a.default})],view:new o.default({center:[0,0],zoom:4})});this.ol3dm=new u.default("../node_modules/@camptocamp/cesium/Build/Cesium/Cesium.js",e,{map:this.map}),t.initialize(this.ol3dm)},d.MainController.$inject=["$rootScope","ngeoOlcsService"],d.module.controller("MainController",d.MainController),t.default=d},375:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(i(376)),o=r(i(378));function r(e){return e&&e.__esModule?e:{default:e}}var a=angular.module("ngeoOlcsModule",[o.default.name,n.default.module.name]);t.default=a},376:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=u(i(!function(){var e=new Error('Cannot find module "goog/asserts.js"');throw e.code="MODULE_NOT_FOUND",e}())),r=u(i(134)),a=u(i(169)),s=u(i(377)),l=u(i(232));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var d=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manager_,this.ngeoDebounce_=t,this.ngeoLocation_=i,this.ngeoStateManager_=n}return e.$inject=["ngeoDebounce","ngeoLocation","ngeoStateManager"],n(e,[{key:"initialize",value:function(e){var t=this;this.manager_=e,this.manager_.on("load",function(){t.cameraToState_()}),this.ngeoStateManager_.getInitialBooleanValue("3d_enabled")&&this.initialStateToCamera_()}},{key:"getManager",value:function(){return this.manager_}},{key:"initialStateToCamera_",value:function(){var e=this.ngeoStateManager_,t=e.getInitialNumberValue(s.default.Permalink3dParam.LON),i=e.getInitialNumberValue(s.default.Permalink3dParam.LAT),n=e.getInitialNumberValue(s.default.Permalink3dParam.ELEVATION),r=e.getInitialNumberValue(s.default.Permalink3dParam.HEADING)||0,a=e.getInitialNumberValue(s.default.Permalink3dParam.PITCH)||0;return o.default.assert(void 0!==t),o.default.assert(void 0!==i),o.default.assert(void 0!==n),this.manager_.set3dWithView(t,i,n,r,a)}},{key:"cameraToState_",value:function(){var e=this,t=this.manager_.getOl3d().getCesiumScene().camera;t.moveEnd.addEventListener(this.ngeoDebounce_(function(){var i,n=t.positionCartographic;e.ngeoStateManager_.updateState((c(i={},s.default.Permalink3dParam.ENABLED,!0),c(i,s.default.Permalink3dParam.LON,Cesium.Math.toDegrees(n.longitude).toFixed(5)),c(i,s.default.Permalink3dParam.LAT,Cesium.Math.toDegrees(n.latitude).toFixed(5)),c(i,s.default.Permalink3dParam.ELEVATION,n.height.toFixed(0)),c(i,s.default.Permalink3dParam.HEADING,Cesium.Math.toDegrees(t.heading).toFixed(3)),c(i,s.default.Permalink3dParam.PITCH,Cesium.Math.toDegrees(t.pitch).toFixed(3)),i))},1e3,!0)),this.manager_.on("toggle",function(t){t.target.is3dEnabled()||e.remove3dState_()})}},{key:"remove3dState_",value:function(){var e=this;this.ngeoLocation_.getParamKeysWithPrefix(s.default.Permalink3dParam.PREFIX).forEach(function(t){e.ngeoStateManager_.deleteParam(t)})}}]),e}(),h="ngeoOlcsService";d.module=angular.module(h,[r.default.name,a.default.module.name,l.default.module.name]).service(h,d);var m=d;t.default=m},377:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={Permalink3dParam:{ENABLED:"3d_enabled",LON:"3d_lon",LAT:"3d_lat",ELEVATION:"3d_elevation",HEADING:"3d_heading",PITCH:"3d_pitch",PREFIX:"3d_"}};t.default=n},378:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=l(i(!function(){var e=new Error('Cannot find module "goog/asserts.js"');throw e.code="MODULE_NOT_FOUND",e}())),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(45)),a=l(i(96)),s=l(i(!function(){var e=new Error('Cannot find module "ngeo/index.js"');throw e.code="MODULE_NOT_FOUND",e}()));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(t)return t;var i=e.ngeoOlcsControls3dTemplateUrl;return i||s.default.baseModuleTemplateUrl+"/olcs/controls3d.html"}u.$inject=["$attrs","ngeoOlcsControls3dTemplateUrl"];var c={bindings:{minTilt:"<?",maxTilt:"<?",ol3dm:"<?"},controller:function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element_=t,this.ol3dm,this.minTilt,this.maxTilt,this.tiltRightEl_,this.tiltLeftEl_,this.rotation3dEl_,this.angle3dEl_,this.previousRotation_,this.previousViewMatrix_,this.animationFrameRequestId_,this.olcsService_=i}return e.$inject=["$element","ngeoOlcsService"],n(e,[{key:"updateWidget_",value:function(){var e,t,i=this,n=this.ol3dm.getOl3d().getOlView().getRotation();e=this.previousRotation_,t=n,Number.isFinite(t)&&(!Number.isFinite(e)||Math.abs(t-e)>.05)&&(this.rotateElement_(this.rotation3dEl_,n),this.previousRotation_=n);var o=this.ol3dm.getCesiumViewMatrix();if(!Cesium.Matrix4.equalsEpsilon(this.previousViewMatrix_,o,1e-5)){var r=this.ol3dm.getTiltOnGlobe();if(Number.isFinite(r||0)){this.rotateElement_(this.angle3dEl_,r),this.previousViewMatrix_=Cesium.Matrix4.clone(o);r-this.minTilt<.01?this.tiltRightEl_.addClass("ngeo-right-inactive"):this.tiltRightEl_.hasClass("ngeo-right-inactive")&&this.tiltRightEl_.removeClass("ngeo-right-inactive"),this.maxTilt-r<.01?this.tiltLeftEl_.addClass("ngeo-left-inactive"):this.tiltLeftEl_.hasClass("ngeo-left-inactive")&&this.tiltLeftEl_.removeClass("ngeo-left-inactive")}}this.animationFrameRequestId_=requestAnimationFrame(function(){return i.updateWidget_()})}},{key:"$onDestroy",value:function(){this.animationFrameRequestId_&&cancelAnimationFrame(this.animationFrameRequestId_)}},{key:"$onInit",value:function(){void 0===this.minTilt&&(this.minTilt=0),void 0===this.maxTilt&&(this.maxTilt=7*Math.PI/16),this.ol3dm||(this.ol3dm=o.default.assert(this.olcsService_.getManager())),this.tiltRightEl_=this.element_.find(".ngeo-tilt-right"),this.tiltLeftEl_=this.element_.find(".ngeo-tilt-left"),this.rotation3dEl_=this.element_.find(".ngeo-rotation3d"),this.angle3dEl_=this.element_.find(".ngeo-angle3d"),this.updateWidget_()}},{key:"rotateElement_",value:function(e,t){var i="rotate("+t+"rad)";e.css({"-moz-transform":i,"-webkit-transform":i,"-o-transform":i,"-ms-transform":i,transform:i})}},{key:"rotate",value:function(e){e=Cesium.Math.toRadians(e),this.ol3dm.setHeading(e)}},{key:"tilt",value:function(e){e=Cesium.Math.toRadians(e);var t=this.ol3dm.getTiltOnGlobe();t+e<this.minTilt?e=this.minTilt-t:t+e>this.maxTilt&&(e=this.maxTilt-t);var i=this.ol3dm.getCesiumScene();a.default.rotateAroundBottomCenter(i,e)}},{key:"zoom",value:function(e){var t=this.ol3dm.getOlView(),i=t.getResolution(),n=t.constrainResolution(i,e);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:n,duration:250,easing:r.easeOut})}}]),e}(),templateUrl:u},d="ngeoOlcsControls3d",h=angular.module(d,[]).component(d,c).value("ngeoOlcsControls3dTemplateUrl","");t.default=h},379:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(380),a=(n=r)&&n.__esModule?n:{default:n};var s=function(e){function t(e,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.rootScope_=i,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),o(t,[{key:"toggle3d",value:function(){var e=this;return function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toggle3d",this).call(this).then(function(){e.rootScope_.$apply()})}}]),t}();t.default=s},380:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i(22),i(8),i(1),i(72);i(96);const n=function(e,t){this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this.verboseRendering=t,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.lastCameraViewMatrix_=new Cesium.Matrix4,this.lastCameraMoveTime_=0,this.stoppedRendering=!1,this._removePostRenderListener=this.scene_.postRender.addEventListener(this.postRender.bind(this)),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"];const i=Cesium.Camera.prototype;this.interceptedAPIs_=[[i,"setView"],[i,"move"],[i,"rotate"],[i,"lookAt"],[i,"flyTo"],[i,"flyToHome"],[i,"flyToBoundingSphere"]],this.originalAPIs_=this.interceptedAPIs_.map(e=>e[0][e[1]]),this.originalLoadWithXhr_=Cesium.loadWithXhr.load,this.originalScheduleTask_=Cesium.TaskProcessor.prototype.scheduleTask,this.enable()};n.prototype.enable=function(){for(const e of this.repaintEventNames_)this.canvas_.addEventListener(e,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1);const e=this;Cesium.loadWithXhr.load=function(t,i,n,o,r,a,s,l,u){a.promise.always(e._boundNotifyRepaintRequired),e.originalLoadWithXhr_(...arguments)},Cesium.TaskProcessor.prototype.scheduleTask=function(t,i){const n=e.originalScheduleTask_.call(this,t,i),o=this;if(!o._originalWorkerMessageSinkRepaint){const t=o._worker;o._originalWorkerMessageSinkRepaint=t.onmessage,t.onmessage=function(t){o._originalWorkerMessageSinkRepaint(t),e.notifyRepaintRequired()}}return n};for(let t=0;t<this.interceptedAPIs_.length;++t){const i=this.interceptedAPIs_[t],n=i[0],o=this.originalAPIs_[t];n[i[1]]=function(...t){o.apply(this,t),e.notifyRepaintRequired()}}this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)},n.prototype.disable=function(){this._removePostRenderListener&&(this._removePostRenderListener(),this._removePostRenderListener=void 0);for(const e of this.repaintEventNames_)this.canvas_.removeEventListener(e,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),Cesium.loadWithXhr.load=this.originalLoadWithXhr_,Cesium.TaskProcessor.prototype.scheduleTask=this.originalScheduleTask_;for(let e=0;e<this.interceptedAPIs_.length;++e){const t=this.interceptedAPIs_[e],i=t[0],n=this.originalAPIs_[e];i[t[1]]=n}this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired)},n.prototype.postRender=function(e){const t=Date.now(),i=this.scene_,n=i.camera;Cesium.Matrix4.equalsEpsilon(this.lastCameraViewMatrix_,n.viewMatrix,1e-5)||(this.lastCameraMoveTime_=t);const o=t-this.lastCameraMoveTime_<1e3,r=i.globe._surface,a=!r.tileProvider.ready||r._tileLoadQueueHigh.length>0||r._tileLoadQueueMedium.length>0||r._tileLoadQueueLow.length>0||r._debug.tilesWaitingForChildren>0,s=i.tweens;o||a||0!=s.length||(this.verboseRendering&&console.log(`stopping rendering @ ${Date.now()}`),this.ol3d.setBlockCesiumRendering(!0),this.stoppedRendering=!0),Cesium.Matrix4.clone(n.viewMatrix,this.lastCameraViewMatrix_)},n.prototype.restartRenderLoop=function(){this.notifyRepaintRequired()},n.prototype.notifyRepaintRequired=function(){this.verboseRendering&&this.stoppedRendering&&console.log(`starting rendering @ ${Date.now()}`),this.lastCameraMoveTime_=Date.now(),this.ol3d.setBlockCesiumRendering(!1),this.stoppedRendering=!1},n.prototype.setDebug=function(e){this.verboseRendering=e};i(38),i(11);throw new Error('Cannot find module "goog/asserts"')},4:function(e,t,i){"use strict";var n=i(0),o=i(16),r=i(17);const a=function(e){const t=e||{},i=void 0!==t.projection?t.projection:"EPSG:3857",n=void 0!==t.tileGrid?t.tileGrid:r.a.createXYZ({extent:r.a.extentFromProjection(i),maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});o.a.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,opaque:t.opaque,projection:i,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition})};Object(n.inherits)(a,o.a),t.a=a},96:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i(45),i(13),i(54);var n=i(8),o=(i(160),i(44),i(16),i(93),i(1));const r=function(e,t){this.source_=e,this.projection_=null,this.fallbackProj_=t||null,this.ready_=!1,this.credit_=null,this.tilingScheme_=null,this.rectangle_=null;const i=this.source_.get("olcs.proxy");i&&("function"==typeof i?this.proxy_={getURL:i}:"string"==typeof i&&(this.proxy_=new Cesium.DefaultProxy(i))),this.errorEvent_=new Cesium.Event,this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.source_.on(o.default.EventType.CHANGE,function(e){this.handleSourceChanged_()},this),this.handleSourceChanged_()};Object.defineProperties(r.prototype,{ready:{get:function(){return this.ready_}},rectangle:{get:function(){return this.rectangle_}},tileWidth:{get:function(){const e=this.source_.getTileGrid();return e?e.getTileSize(0):256}},tileHeight:{get:function(){return this.tileWidth}},maximumLevel:{get:function(){const e=this.source_.getTileGrid();return e?e.getMaxZoom():18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this.tilingScheme_}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this.errorEvent_}},credit:{get:function(){return this.credit_}},proxy:{get:function(){return this.proxy_}},hasAlphaChannel:{get:function(){return!0}},pickFeatures:{get:function(){}}}),r.prototype.handleSourceChanged_=function(){if(!this.ready_&&"ready"==this.source_.getState()){const e=this.source_.getProjection();if(this.projection_=e||this.fallbackProj_,this.projection_==n.default.get("EPSG:4326"))this.tilingScheme_=new Cesium.GeographicTilingScheme;else{if(this.projection_!=n.default.get("EPSG:3857"))return;this.tilingScheme_=new Cesium.WebMercatorTilingScheme}this.rectangle_=this.tilingScheme_.rectangle;const t=r.createCreditForSource(this.source_);this.credit_=t||null,this.ready_=!0}},r.createCreditForSource=function(e){let t="";const i=e.getAttributions();let n,o;if(i&&i.forEach(e=>{t+=`${e.getHTML().replace(/<\/?[^>]+(>|$)/g,"")} `}),0==t.length){const t=e.getLogo();t&&("string"==typeof t?n=t:(n=t.src,o=t.href))}return n||t.length>0?new Cesium.Credit(t,n,o):null},r.prototype.getTileCredits=function(e,t,i){},r.prototype.requestImage=function(e,t,i){const n=this.source_.getTileUrlFunction();if(n&&this.projection_){const o=this.tilingScheme_ instanceof Cesium.GeographicTilingScheme?i+1:i,r=-t-1;let a=n.call(this.source_,[o,e,r],1,this.projection_);return this.proxy_&&(a=this.proxy_.getURL(a)),a?Cesium.ImageryProvider.loadImage(this,a):this.emptyCanvas_}return this.emptyCanvas_};throw new Error('Cannot find module "goog/asserts"')}},[373]);
//# sourceMappingURL=simple3d.32faa4373a3dcd000e80.js.map