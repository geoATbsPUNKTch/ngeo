webpackJsonp([35],{334:function(t,e,r){r(7),t.exports=r(335)},335:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});u(r(63)),u(r(225)),u(r(226));var n=u(r(9)),o=u(r(14)),i=u(r(129)),a=u(r(54)),s=u(r(26)),_=u(r(44)),l=u(r(23)),p=(u(r(!function(){var t=new Error('Cannot find module "ngeo/index.js"');throw t.code="MODULE_NOT_FOUND",t}())),u(r(12)));function u(t){return t&&t.__esModule?t:{default:t}}var c={},d=angular.module("app",[p.default.name]);c.WMS_URL_="https://geomapfish-demo.camptocamp.net/2.2/wsgi/mapserv_proxy",c.PRINT_URL_="https://geomapfish-demo.camptocamp.net/2.2/wsgi/printproxy",c.PRINT_SCALES_=[100,250,500,2500,5e3,1e4,25e3,5e4,1e5,5e5],c.PRINT_FORMAT_="pdf",c.PRINT_LAYOUT_="A4 portrait",c.PRINT_DPI_=72,c.PRINT_PAPER_SIZE_=[555,675],c.MainController=function(t,e,r){this.map=new n.default({layers:[new a.default({source:new _.default({url:c.WMS_URL_,params:{LAYERS:"osm"},serverType:"mapserver"})}),new s.default({source:new l.default({url:"data/polygon-swizerland.json",format:new i.default({defaultDataProjection:"EPSG:21781"})})})],view:new o.default({projection:"EPSG:21781",resolutions:[200,100,50,20,10,5,2.5,2,1],center:[537635,152640],zoom:3})}),this.printState="",this.$timeout_=t,this.print_=e(c.PRINT_URL_),this.printUtils_=r;var p=r.createPrintMaskPostcompose(function(){return c.PRINT_PAPER_SIZE_},function(t){var e=t.size,n=t.viewState.resolution;return void 0!==e&&void 0!==n?r.getOptimalScale(e,n,c.PRINT_PAPER_SIZE_,c.PRINT_SCALES_):c.PRINT_SCALES_[0]});this.map.on("postcompose",p)},c.MainController.$inject=["$timeout","ngeoCreatePrint","ngeoPrintUtils"],c.MainController.prototype.print=function(){var t=this.map,e=t.getSize(),r=t.getView().getResolution(),n=void 0!==e&&void 0!==r?this.printUtils_.getOptimalScale(e,r,c.PRINT_PAPER_SIZE_,c.PRINT_SCALES_):c.PRINT_SCALES_[0],o=c.PRINT_DPI_,i=c.PRINT_FORMAT_,a=c.PRINT_LAYOUT_;this.printState="Printing...";var s=this.print_.createSpec(t,n,o,a,i,{datasource:[],debug:0,comments:"My comments",title:"My print"});this.print_.createReport(s).then(this.handleCreateReportSuccess_.bind(this),this.handleCreateReportError_.bind(this))},c.MainController.prototype.handleCreateReportSuccess_=function(t){var e=t.data;this.getStatus_(e.ref)},c.MainController.prototype.getStatus_=function(t){this.print_.getStatus(t).then(this.handleGetStatusSuccess_.bind(this,t),this.handleGetStatusError_.bind(this))},c.MainController.prototype.handleCreateReportError_=function(t){this.printState="Print error"},c.MainController.prototype.handleGetStatusSuccess_=function(t,e){if(e.data.done)this.printState="",window.location.href=this.print_.getReportUrl(t);else{var r=this;this.$timeout_(function(){r.getStatus_(t)},1e3,!1)}},c.MainController.prototype.handleGetStatusError_=function(t){this.printState="Print error"},d.controller("MainController",c.MainController),e.default=c}},[334]);
//# sourceMappingURL=mapfishprint.14415fa85e1c1f28af96.js.map