webpackJsonp([16],{11:function(e,t,i){"use strict";t.a="1.3.0"},12:function(e,t,i){"use strict";t.a={CARMENTA_SERVER:"carmentaserver",GEOSERVER:"geoserver",MAPSERVER:"mapserver",QGIS:"qgis"}},143:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={assert:function(e,t,i){},assertNumber:function(e,t,i){},assertString:function(e,t,i){},assertFunction:function(e,t,i){},assertObject:function(e,t,i){},assertArray:function(e,t,i){},assertBoolean:function(e,t,i){},assertElement:function(e,t,i){},assertInstanceof:function(e,t,i,n){},assertObjectPrototypeIsIntact:function(){}};t.default=n},159:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(117),o=i(143),s=i.n(o),r=i(62),a=i(110),l=i(6),u=i(57),c=i(16),h=i(42),d=i(23),p=i(2);const m=function(e,t){this.source_=e,this.projection_=null,this.fallbackProj_=t||null,this.ready_=!1,this.credit_=null,this.tilingScheme_=null,this.rectangle_=null;const i=this.source_.get("olcs.proxy");i&&("function"==typeof i?this.proxy_={getURL:i}:"string"==typeof i&&(this.proxy_=new Cesium.DefaultProxy(i))),this.errorEvent_=new Cesium.Event,this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.source_.on(p.default.EventType.CHANGE,function(e){this.handleSourceChanged_()},this),this.handleSourceChanged_()};Object.defineProperties(m.prototype,{ready:{get:function(){return this.ready_}},rectangle:{get:function(){return this.rectangle_}},tileWidth:{get:function(){const e=this.source_.getTileGrid();return e?e.getTileSize(0):256}},tileHeight:{get:function(){return this.tileWidth}},maximumLevel:{get:function(){const e=this.source_.getTileGrid();return e?e.getMaxZoom():18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this.tilingScheme_}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this.errorEvent_}},credit:{get:function(){return this.credit_}},proxy:{get:function(){return this.proxy_}},hasAlphaChannel:{get:function(){return!0}},pickFeatures:{get:function(){}}}),m.prototype.handleSourceChanged_=function(){if(!this.ready_&&"ready"==this.source_.getState()){const e=this.source_.getProjection();if(this.projection_=e||this.fallbackProj_,this.projection_==l.default.get("EPSG:4326"))this.tilingScheme_=new Cesium.GeographicTilingScheme;else{if(this.projection_!=l.default.get("EPSG:3857"))return;this.tilingScheme_=new Cesium.WebMercatorTilingScheme}this.rectangle_=this.tilingScheme_.rectangle;const t=m.createCreditForSource(this.source_);this.credit_=t||null,this.ready_=!0}},m.createCreditForSource=function(e){let t="";const i=e.getAttributions();let n,o;if(i&&i.forEach(e=>{t+=`${e.getHTML().replace(/<\/?[^>]+(>|$)/g,"")} `}),0==t.length){const t=e.getLogo();t&&("string"==typeof t?n=t:(n=t.src,o=t.href))}return n||t.length>0?new Cesium.Credit(t,n,o):null},m.prototype.getTileCredits=function(e,t,i){},m.prototype.requestImage=function(e,t,i){const n=this.source_.getTileUrlFunction();if(n&&this.projection_){const o=this.tilingScheme_ instanceof Cesium.GeographicTilingScheme?i+1:i,s=-t-1;let r=n.call(this.source_,[o,e,s],1,this.projection_);return this.proxy_&&(r=this.proxy_.getURL(r)),r?Cesium.ImageryProvider.loadImage(this,r):this.emptyCanvas_}return this.emptyCanvas_};var f=m;const g={computePixelSizeAtCoordinate:function(e,t){const i=e.camera,n=e.canvas,o=i.frustum,s=Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(i.position,t,new Cesium.Cartesian3)),r=new Cesium.Cartesian2;return o.getPixelDimensions(n.clientWidth,n.clientHeight,s,r)},computeBoundingBoxAtTarget:function(e,t,i){const n=g.computePixelSizeAtCoordinate(e,t),o=Cesium.Transforms.eastNorthUpToFixedFrame(t),s=Cesium.Matrix4.multiplyByPoint(o,new Cesium.Cartesian3(-n.x*i,-n.y*i,0),new Cesium.Cartesian3),r=Cesium.Matrix4.multiplyByPoint(o,new Cesium.Cartesian3(n.x*i,n.y*i,0),new Cesium.Cartesian3);return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray([s,r])},applyHeightOffsetToGeometry:function(e,t){e.applyTransform((e,i,n)=>{if(s.a.assert(e===i),void 0!==n&&n>=3)for(let e=0;e<i.length;e+=n)i[e+2]=i[e+2]+t;return i})},rotateAroundAxis:function(e,t,i,o,r){const a=Cesium.Math.clamp,l=Cesium.defaultValue,u=r||{},c=l(u.duration,500),h=l(u.easing,n.default.linear),d=u.callback;let p=0;const m=new Cesium.Matrix4,f=Date.now(),g=function(){const n=Date.now(),r=h(a((n-f)/c,0,1));s.a.assert(r>=p),e.transform.clone(m);const l=(r-p)*t;p=r,e.lookAtTransform(o),e.rotate(i,l),e.lookAtTransform(m),r<1?window.requestAnimationFrame(g):d&&d()};window.requestAnimationFrame(g)},setHeadingUsingBottomCenter:function(e,t,i,n){const o=e.camera,s=g.computeAngleToZenith(e,i),r=o.right,a=Cesium.Quaternion.fromAxisAngle(r,s),l=Cesium.Matrix3.fromQuaternion(a),u=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(o.position,i,u);const c=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(l,u,c),Cesium.Cartesian3.add(c,i,c);const h=Cesium.Matrix4.fromTranslation(c);(0,g.rotateAroundAxis)(o,t,c,h,n)},pickOnTerrainOrEllipsoid:function(e,t){const i=e.camera.getPickRay(t);return e.globe.pick(i,e)||e.camera.pickEllipsoid(t)},pickBottomPoint:function(e){const t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight);return g.pickOnTerrainOrEllipsoid(e,i)},pickCenterPoint:function(e){const t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2);return g.pickOnTerrainOrEllipsoid(e,i)},computeSignedTiltAngleOnGlobe:function(e){const t=e.camera,i=new Cesium.Ray(t.position,t.direction);let n=e.globe.pick(i,e);if(!n){const e=Cesium.Ellipsoid.WGS84,t=Cesium.IntersectionTests.rayEllipsoid(i,e);t&&(n=Cesium.Ray.getPoint(i,t.start))}if(!n)return;const o=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(n,o);const s=(0,g.signedAngleBetween)(t.direction,o,t.right)-Math.PI;return Cesium.Math.convertLongitudeRange(s)},bottomFovRay:function(e){const t=e.camera,i=t.frustum.fovy/2,n=t.direction,o=Cesium.Quaternion.fromAxisAngle(t.right,i),s=Cesium.Matrix3.fromQuaternion(o),r=new Cesium.Cartesian3;return Cesium.Matrix3.multiplyByVector(s,n,r),new Cesium.Ray(t.position,r)},signedAngleBetween:function(e,t,i){const n=new Cesium.Cartesian3,o=new Cesium.Cartesian3,s=new Cesium.Cartesian3;Cesium.Cartesian3.normalize(e,n),Cesium.Cartesian3.normalize(t,o),Cesium.Cartesian3.cross(n,o,s);const r=Cesium.Cartesian3.dot(n,o),a=Cesium.Cartesian3.magnitude(s),l=Cesium.Cartesian3.dot(i,s),u=Math.atan2(a,r);return l>=0?u:-u},computeAngleToZenith:function(e,t){const i=e.camera,n=i.frustum.fovy/2,o=g.bottomFovRay(e),s=Cesium.Cartesian3.clone(o.direction);Cesium.Cartesian3.negate(s,s);const r=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(t,r);const a=new Cesium.Cartesian3;return Cesium.Cartesian3.negate(i.right,a),g.signedAngleBetween(r,s,a)+n},lookAt:function(e,t,i){if(i){const e=i.getHeight(t);t.height=e||0}const n=Cesium.Ellipsoid.WGS84,o=n.cartographicToCartesian(t),s=e.position,r=new Cesium.Cartesian3;n.geocentricSurfaceNormal(s,r),e.lookAt(s,o,r)},extentToRectangle:function(e,t){if(e&&t){const i=l.default.transformExtent(e,t,"EPSG:4326");return Cesium.Rectangle.fromDegrees(i[0],i[1],i[2],i[3])}return null},tileLayerToImageryLayer:function(e,t){if(!(e instanceof r.default||e instanceof a.default))return null;let i=null,n=e.getSource();if(n instanceof c.default&&n.getUrl()&&n.getImageLoadFunction()===u.default.defaultImageLoadFunction&&(n=new d.default({url:n.getUrl(),params:n.getParams(),attributions:n.getAttributions(),projection:n.getProjection(),logo:n.getLogo(),"olcs.proxy":n.get("olcs.proxy"),"olcs.imagesource":n})),!(n instanceof h.a))return null;{let e=n.getProjection();if(e){if(e!==t)return null}else e=t;const o=e===l.default.get("EPSG:3857"),s=e===l.default.get("EPSG:4326");if(!o&&!s)return null;i=new f(n,t)}const o={},s=e.get("olcs.extent")||e.getExtent();return s&&(o.rectangle=g.extentToRectangle(s,t)),new Cesium.ImageryLayer(i,o)},updateCesiumLayerProperties:function(e,t){let i=1,n=!0;[e.layer].concat(e.parents).forEach(e=>{const t=e.getOpacity();void 0!==t&&(i*=t);const o=e.getVisible();void 0!==o&&(n&=o)}),t.alpha=i,t.show=n},ol4326CoordinateToCesiumCartesian:function(e){const t=e;return t.length>2?Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]):Cesium.Cartesian3.fromDegrees(t[0],t[1])},ol4326CoordinateArrayToCsCartesians:function(e){s.a.assert(null!==e);const t=g.ol4326CoordinateToCesiumCartesian,i=[];for(let n=0;n<e.length;++n)i.push(t(e[n]));return i},olGeometryCloneTo4326:function(e,t){s.a.assert(t);const i=l.default.get("EPSG:4326"),n=l.default.get(t);if(n!==i){const t=e.getProperties();(e=e.clone()).transform(n,i),e.setProperties(t)}return e},convertColorToCesium:function(e){return e=e||"black",Array.isArray(e)?new Cesium.Color(Cesium.Color.byteToFloat(e[0]),Cesium.Color.byteToFloat(e[1]),Cesium.Color.byteToFloat(e[2]),e[3]):"string"==typeof e?Cesium.Color.fromCssColorString(e):void s.a.fail("impossible")},convertUrlToCesium:function(e){let t="";const i=/\{(\d|[a-z])-(\d|[a-z])\}/,n=i.exec(e);if(n){e=e.replace(i,"{s}");const o=n[1].charCodeAt(0),s=n[2].charCodeAt(0);let r;for(r=o;r<=s;++r)t+=String.fromCharCode(r)}return{url:e,subdomains:t}},resetToNorthZenith:function(e,t){return new Promise((i,n)=>{const o=t.camera,s=g.pickBottomPoint(t);if(!s)return void n("Could not get bottom pivot");const r=e.getView().getRotation();if(void 0===r)return void n("The view is not initialized");const a=g.computeAngleToZenith(t,s);g.setHeadingUsingBottomCenter(t,r,s);const l=Cesium.Matrix4.fromTranslation(s),u=o.right,c={callback:()=>{const t=e.getView();g.normalizeView(t),i()}};g.rotateAroundAxis(o,-a,u,l,c)})},rotateAroundBottomCenter:function(e,t){return new Promise((i,n)=>{const o=e.camera,s=g.pickBottomPoint(e);if(!s)return void n("could not get bottom pivot");const r={callback:i},a=Cesium.Matrix4.fromTranslation(s),l=o.right;(0,g.rotateAroundAxis)(o,-t,l,a,r)})},normalizeView:function(e,t=0){const i=e.getResolution();e.setRotation(t),e.setResolution(e.constrainResolution(i))}};t.default=g},16:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(11),o=i(0),s=i(63),r=i(56),a=i(2),l=i(9),u=i(4);const c=function(e,t,i,n,o,a){s.a.call(this,e,t,i,r.a.IDLE),this.src_=n,this.image_=new Image,null!==o&&(this.image_.crossOrigin=o),this.imageListenerKeys_=null,this.state=r.a.IDLE,this.imageLoadFunction_=a};Object(o.inherits)(c,s.a),c.prototype.getImage=function(){return this.image_},c.prototype.handleImageError_=function(){this.state=r.a.ERROR,this.unlistenImage_(),this.changed()},c.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=Object(u.getHeight)(this.extent)/this.image_.height),this.state=r.a.LOADED,this.unlistenImage_(),this.changed()},c.prototype.load=function(){this.state!=r.a.IDLE&&this.state!=r.a.ERROR||(this.state=r.a.LOADING,this.changed(),this.imageListenerKeys_=[a.default.listenOnce(this.image_,l.a.ERROR,this.handleImageError_,this),a.default.listenOnce(this.image_,l.a.LOAD,this.handleImageLoad_,this)],this.imageLoadFunction_(this,this.src_))},c.prototype.setImage=function(e){this.image_=e},c.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(a.default.unlistenByKey),this.imageListenerKeys_=null};var h=c,d=i(10),p=i(5),m=i(6),f=i(28),g=i(57),_=i(12),y=i(15),v=i(22);const C=function(e){const t=e||{};g.default.call(this,{attributions:t.attributions,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null,this.url_=t.url,this.imageLoadFunction_=void 0!==t.imageLoadFunction?t.imageLoadFunction:g.default.defaultImageLoadFunction,this.params_=t.params||{},this.v13_=!0,this.updateV13_(),this.serverType_=t.serverType,this.hidpi_=void 0===t.hidpi||t.hidpi,this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=void 0!==t.ratio?t.ratio:1.5};Object(o.inherits)(C,g.default),C.GETFEATUREINFO_IMAGE_SIZE_=[101,101],C.prototype.getGetFeatureInfoUrl=function(e,t,i,o){if(void 0===this.url_)return;const s=Object(m.get)(i),r=this.getProjection();r&&r!==s&&(t=f.a.calculateSourceResolution(r,s,e,t),e=Object(m.transform)(e,s,r));const a=Object(u.getForViewAndSize)(e,t,0,C.GETFEATUREINFO_IMAGE_SIZE_),l={SERVICE:"WMS",VERSION:n.a,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object(p.assign)(l,this.params_,o);const c=Math.floor((e[0]-a[0])/t),h=Math.floor((a[3]-e[1])/t);return l[this.v13_?"I":"X"]=c,l[this.v13_?"J":"Y"]=h,this.getRequestUrl_(a,C.GETFEATUREINFO_IMAGE_SIZE_,1,r||s,l)},C.prototype.getParams=function(){return this.params_},C.prototype.getImageInternal=function(e,t,i,o){if(void 0===this.url_)return null;t=this.findNearestResolution(t),1==i||this.hidpi_&&void 0!==this.serverType_||(i=1);const s=t/i,r=Object(u.getCenter)(e),c=Math.ceil(Object(u.getWidth)(e)/s),d=Math.ceil(Object(u.getHeight)(e)/s),m=Object(u.getForViewAndSize)(r,s,0,[c,d]),f=Math.ceil(this.ratio_*Object(u.getWidth)(e)/s),g=Math.ceil(this.ratio_*Object(u.getHeight)(e)/s),_=Object(u.getForViewAndSize)(r,s,0,[f,g]),y=this.image_;if(y&&this.renderedRevision_==this.getRevision()&&y.getResolution()==t&&y.getPixelRatio()==i&&Object(u.containsExtent)(y.getExtent(),m))return y;const v={SERVICE:"WMS",VERSION:n.a,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};Object(p.assign)(v,this.params_),this.imageSize_[0]=Math.round(Object(u.getWidth)(_)/s),this.imageSize_[1]=Math.round(Object(u.getHeight)(_)/s);const C=this.getRequestUrl_(_,this.imageSize_,i,o,v);return this.image_=new h(_,t,i,C,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),a.default.listen(this.image_,l.a.CHANGE,this.handleImageChange,this),this.image_},C.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},C.prototype.getRequestUrl_=function(e,t,i,n,o){if(Object(d.a)(void 0!==this.url_,9),o[this.v13_?"CRS":"SRS"]=n.getCode(),"STYLES"in this.params_||(o.STYLES=""),1!=i)switch(this.serverType_){case _.a.GEOSERVER:const e=90*i+.5|0;"FORMAT_OPTIONS"in o?o.FORMAT_OPTIONS+=";dpi:"+e:o.FORMAT_OPTIONS="dpi:"+e;break;case _.a.MAPSERVER:o.MAP_RESOLUTION=90*i;break;case _.a.CARMENTA_SERVER:case _.a.QGIS:o.DPI=90*i;break;default:Object(d.a)(!1,8)}o.WIDTH=t[0],o.HEIGHT=t[1];const s=n.getAxisOrientation();let r;return r=this.v13_&&"ne"==s.substr(0,2)?[e[1],e[0],e[3],e[2]]:e,o.BBOX=r.join(","),Object(v.appendParams)(this.url_,o)},C.prototype.getUrl=function(){return this.url_},C.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()},C.prototype.setUrl=function(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())},C.prototype.updateParams=function(e){Object(p.assign)(this.params_,e),this.updateV13_(),this.image_=null,this.changed()},C.prototype.updateV13_=function(){const e=this.params_.VERSION||n.a;this.v13_=y.default.compareVersions(e,"1.3")>=0};t.default=C},21:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),s=i(43),r=(n=s)&&n.__esModule?n:{default:n};var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.default.call(this,e),this.detail=t};o.inherits(a,r.default),t.default=a},23:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(11),o=i(0),s=i(10),r=i(4),a=i(5),l=i(14),u=i(6),c=i(28),h=i(60),d=i(42),p=i(12),m=i(61),f=i(15),g=i(22);const _=function(e){const t=e||{},i=t.params||{},n=!("TRANSPARENT"in i)||i.TRANSPARENT;d.a.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,opaque:!n,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition}),this.gutter_=void 0!==t.gutter?t.gutter:0,this.params_=i,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=void 0===t.hidpi||t.hidpi,this.tmpExtent_=Object(r.createEmpty)(),this.updateV13_(),this.setKey(this.getKeyForParams_())};Object(o.inherits)(_,d.a),_.prototype.getGetFeatureInfoUrl=function(e,t,i,o){const s=Object(u.get)(i),l=this.getProjection();let d=this.getTileGrid();d||(d=this.getTileGridForProjection(s));const p=d.getTileCoordForCoordAndResolution(e,t);if(d.getResolutions().length<=p[0])return;let m=d.getResolution(p[0]),f=d.getTileCoordExtent(p,this.tmpExtent_),g=h.default.toSize(d.getTileSize(p[0]),this.tmpSize);const _=this.gutter_;0!==_&&(g=h.default.buffer(g,_,this.tmpSize),f=Object(r.buffer)(f,m*_,f)),l&&l!==s&&(m=c.a.calculateSourceResolution(l,s,e,m),f=Object(u.transformExtent)(f,s,l),e=Object(u.transform)(e,s,l));const y={SERVICE:"WMS",VERSION:n.a,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object(a.assign)(y,this.params_,o);const v=Math.floor((e[0]-f[0])/m),C=Math.floor((f[3]-e[1])/m);return y[this.v13_?"I":"X"]=v,y[this.v13_?"J":"Y"]=C,this.getRequestUrl_(p,g,f,1,l||s,y)},_.prototype.getGutterInternal=function(){return this.gutter_},_.prototype.getParams=function(){return this.params_},_.prototype.getRequestUrl_=function(e,t,i,n,o,r){const a=this.urls;if(!a)return;if(r.WIDTH=t[0],r.HEIGHT=t[1],r[this.v13_?"CRS":"SRS"]=o.getCode(),"STYLES"in this.params_||(r.STYLES=""),1!=n)switch(this.serverType_){case p.a.GEOSERVER:const e=90*n+.5|0;"FORMAT_OPTIONS"in r?r.FORMAT_OPTIONS+=";dpi:"+e:r.FORMAT_OPTIONS="dpi:"+e;break;case p.a.MAPSERVER:r.MAP_RESOLUTION=90*n;break;case p.a.CARMENTA_SERVER:case p.a.QGIS:r.DPI=90*n;break;default:Object(s.a)(!1,52)}const u=o.getAxisOrientation(),c=i;let h,d;this.v13_&&"ne"==u.substr(0,2)&&(h=i[0],c[0]=i[1],c[1]=h,h=i[2],c[2]=i[3],c[3]=h);(r.BBOX=c.join(","),1==a.length)?d=a[0]:d=a[Object(l.modulo)(m.a.hash(e),a.length)];return Object(g.appendParams)(d,r)},_.prototype.getTilePixelRatio=function(e){return this.hidpi_&&void 0!==this.serverType_?e:1},_.prototype.getKeyForParams_=function(){let e=0;const t=[];for(const i in this.params_)t[e++]=i+"-"+this.params_[i];return t.join("/")},_.prototype.fixedTileUrlFunction=function(e,t,i){let o=this.getTileGrid();if(o||(o=this.getTileGridForProjection(i)),o.getResolutions().length<=e[0])return;1==t||this.hidpi_&&void 0!==this.serverType_||(t=1);const s=o.getResolution(e[0]);let l=o.getTileCoordExtent(e,this.tmpExtent_),u=h.default.toSize(o.getTileSize(e[0]),this.tmpSize);const c=this.gutter_;0!==c&&(u=h.default.buffer(u,c,this.tmpSize),l=Object(r.buffer)(l,s*c,l)),1!=t&&(u=h.default.scale(u,t,this.tmpSize));const d={SERVICE:"WMS",VERSION:n.a,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return Object(a.assign)(d,this.params_),this.getRequestUrl_(e,u,l,t,i,d)},_.prototype.updateParams=function(e){Object(a.assign)(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())},_.prototype.updateV13_=function(){const e=this.params_.VERSION||n.a;this.v13_=f.default.compareVersions(e,"1.3")>=0},t.default=_},24:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(i(1)),o=s(i(47));function s(e){return e&&e.__esModule?e:{default:e}}var r={};r.module=angular.module("ngeoDataSources",[]),r.module.value("ngeoDataSources",new o.default),n.default.module.requires.push(r.module.name),t.default=r},26:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(1);(n=s)&&n.__esModule;var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inRange_=!1!==t.inRange,this.visible_=!0===t.visible,this.attributes=t.attributes||null,this.id_=t.id,this.identifierAttribute_=t.identifierAttribute,this.maxResolution_=t.maxResolution,this.minResolution_=t.minResolution,this.name_=t.name}return o(e,[{key:"getAttributes",value:function(){return this.attributes}},{key:"setAttributes",value:function(e){this.attributes=e}},{key:"inRange",get:function(){return this.inRange_},set:function(e){this.inRange_=e}},{key:"visible",get:function(){return this.visible_},set:function(e){this.visible_=e}},{key:"id",get:function(){return this.id_}},{key:"identifierAttribute",get:function(){return this.identifierAttribute_}},{key:"maxResolution",get:function(){return this.maxResolution_}},{key:"minResolution",get:function(){return this.minResolution_}},{key:"name",get:function(){return this.name_}},{key:"queryable",get:function(){return!1}},{key:"supportsDynamicInRange",get:function(){return null!==this.maxResolution||null!==this.minResolution}}]),e}();t.default=r},29:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d(i(1)),o=h(i(0)),s=d(i(20)),r=h(i(5)),a=d(i(18)),l=d(i(17)),u=d(i(3)),c=d(i(36));function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function d(e){return e&&e.__esModule?e:{default:e}}var p=function(){this.featureUidToGroupIndex_={},this.groups_=[],this.source_=new a.default({useSpatialIndex:!1}),this.layer_=new s.default({source:this.source_,style:this.styleFunction_.bind(this),updateWhileAnimating:!0,updateWhileInteracting:!0})};p.prototype.addFeature=function(e,t){u.default.assert(t>=0),u.default.assert(t<this.groups_.length);var i=o.getUid(e).toString();this.featureUidToGroupIndex_[i]=t,this.groups_[t].features[i]=e,this.source_.addFeature(e)},p.prototype.removeFeature=function(e,t){u.default.assert(t>=0),u.default.assert(t<this.groups_.length);var i=o.getUid(e).toString();delete this.featureUidToGroupIndex_[i],delete this.groups_[t].features[i],this.source_.removeFeature(e)},p.prototype.clear=function(e){u.default.assert(e>=0),u.default.assert(e<this.groups_.length);var t=this.groups_[e];for(var i in t.features)this.removeFeature(t.features[i],e);u.default.assert(r.isEmpty(t.features))},p.prototype.getLayer=function(){return this.layer_},p.prototype.getFeatureOverlay=function(){var e=this.groups_.length;return this.groups_.push({styleFunction:l.default.defaultFunction,features:{}}),new c.default(this,e)},p.prototype.init=function(e){this.layer_.setMap(e)},p.prototype.setStyle=function(e,t){u.default.assert(t>=0),u.default.assert(t<this.groups_.length),this.groups_[t].styleFunction=null===e?l.default.defaultFunction:l.default.createFunction(e)},p.prototype.styleFunction_=function(e,t){var i=o.getUid(e).toString();u.default.assert(i in this.featureUidToGroupIndex_);var n=this.featureUidToGroupIndex_[i];return this.groups_[n].styleFunction(e,t)},(p.module=angular.module("ngeoFeatureOverlayMgr",[c.default.module.name])).service("ngeoFeatureOverlayMgr",p),n.default.module.requires.push(p.module.name),t.default=p},3:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o={doAssertFailure_:function(e,t,i,n){var s="Assertion failed",r=void 0;i?(s+=": "+i,r=n):e&&(s+=": "+e,r=t);var a=new o.AssertionError(""+s,r||[]);o.errorHandler_(a)},setErrorHandler:function(e){o.ENABLE_ASSERTS&&(o.errorHandler_=e)},assert:function(e,t,i){return o.ENABLE_ASSERTS&&!e&&o.doAssertFailure_("",null,t,Array.prototype.slice.call(arguments,2)),e},fail:function(e,t){o.ENABLE_ASSERTS&&o.errorHandler_(new o.AssertionError("Failure"+(e?": "+e:""),Array.prototype.slice.call(arguments,1)))},assertNumber:function(e,t,i){return o.ENABLE_ASSERTS&&!goog.isNumber(e)&&o.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},assertString:function(e,t,i){return o.ENABLE_ASSERTS&&!goog.isString(e)&&o.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},assertFunction:function(e,t,i){return o.ENABLE_ASSERTS&&!goog.isFunction(e)&&o.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},assertObject:function(e,t,i){return o.ENABLE_ASSERTS&&!goog.isObject(e)&&o.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},assertArray:function(e,t,i){return o.ENABLE_ASSERTS&&!goog.isArray(e)&&o.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},assertBoolean:function(e,t,i){return o.ENABLE_ASSERTS&&!goog.isBoolean(e)&&o.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},assertElement:function(e,t,i){return!o.ENABLE_ASSERTS||goog.isObject(e)&&e.nodeType==goog.dom.NodeType.ELEMENT||o.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},assertInstanceof:function(e,t,i,n){return!o.ENABLE_ASSERTS||e instanceof t||o.doAssertFailure_("Expected instanceof %s but got %s.",[o.getType_(t),o.getType_(e)],i,Array.prototype.slice.call(arguments,3)),e},assertObjectPrototypeIsIntact:function(){for(var e in Object.prototype)o.fail(e+" should not be enumerable in Object.prototype.")},getType_:function(e){return e instanceof Function?e.displayName||e.name||"unknown type name":e instanceof Object?e.constructor.displayName||e.constructor.name||Object.prototype.toString.call(e):null===e?"null":void 0===e?"undefined":n(e)}};t.default=o},32:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(i(1)),o=c(i(33)),s=c(i(34)),r=c(i(29)),a=c(i(37)),l=c(i(38)),u=c(i(39));function c(e){return e&&e.__esModule?e:{default:e}}var h=angular.module("ngeoMapModule",[n.default.module.name,o.default.module.name,s.default.name,r.default.module.name,a.default.name,l.default.name,u.default.name]);t.default=h},33:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=p(i(3)),o=p(i(1)),s=p(i(21)),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0)),a=p(i(19)),l=p(i(52)),u=p(i(50)),c=p(i(16)),h=p(i(23)),d=p(i(58));function p(e){return e&&e.__esModule?e:{default:e}}var m=function(){a.default.call(this),this.mapUids_={}};r.inherits(m,a.default),m.prototype.get=function(e){return r.getUid(e).toString()in this.mapUids_?e.getLayers().item(0):null},m.prototype.set=function(e,t){var i=r.getUid(e).toString(),o=this.get(e);null!==o?(n.default.assert(i in this.mapUids_),null!==t?e.getLayers().setAt(0,t):(e.getLayers().removeAt(0),delete this.mapUids_[i])):null!==t&&(e.getLayers().insertAt(0,t),this.mapUids_[i]=!0);var a=new s.default("change",{current:t,previous:o});return this.dispatchEvent(a),o},m.prototype.updateDimensions=function(e,t){var i=this.get(e);if(i){var o=[i];i instanceof l.default&&(o=i.getLayers().getArray()),o.forEach(function(e){if(n.default.assertInstanceof(e,u.default),e){var i=!1,o={};for(var s in e.get("dimensions")){var r=t[s];void 0!==r&&(o[s]=r,i=!0)}if(i){var a=e.getSource();a instanceof d.default?(a.updateDimensions(o),a.refresh()):(a instanceof h.default||a instanceof c.default)&&(a.updateParams(o),a.refresh())}}})}},(m.module=angular.module("ngeoBackgroundLayerMgr",[])).service("ngeoBackgroundLayerMgr",m),o.default.module.requires.push(m.module.name),t.default=m},34:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(i(3)),o=l(i(1)),s=l(i(35)),r=l(i(2)),a=l(i(7));function l(e){return e&&e.__esModule?e:{default:e}}var u=angular.module("ngeoMap",[s.default.module.name]);o.default.module.requires.push(u.name),u.directive_=function(e,t){return{restrict:"A",link:function(i,o,s){var l=s.ngeoMap,u=i.$eval(l);n.default.assertInstanceof(u,a.default),u.setTarget(o[0]),t.map=u;var c=s.ngeoMapManageResize;if(i.$eval(c)){var h=s.ngeoMapResizeTransition,d=i.$eval(h);r.default.listen(e,"resize",function(){if(d){var t=Date.now(),i=!0;!function n(){u.updateSize(),u.renderSync(),i&&e.requestAnimationFrame(n),Date.now()-t>d&&(i=!1)}()}else u.updateSize()})}}}},u.directive_.$inject=["$window","ngeoSyncDataSourcesMap"],u.directive("ngeoMap",u.directive_),t.default=u},35:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=h(i(1)),s=h(i(26)),r=h(i(24)),a=h(i(2)),l=h(i(19)),u=h(i(31)),c=h(i(3));function h(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ngeoDataSources_=t,this.map_=null,this.listenerKeys_=[],a.default.listen(this.ngeoDataSources_,"add",this.handleDataSourcesAdd_,this)}return e.$inject=["ngeoDataSources"],n(e,[{key:"bindMap_",value:function(e){var t=e.getView();this.listenerKeys_.push(a.default.listen(t,"change:resolution",this.handleViewResolutionChange_,this));var i=t.getResolution();c.default.assertNumber(i),this.syncDataSourcesToResolution_(i)}},{key:"unbindMap_",value:function(e){l.default.unByKey(this.listenerKeys_),this.listenerKeys_=[]}},{key:"handleViewResolutionChange_",value:function(e){var t=e.target;c.default.assertInstanceof(t,u.default);var i=t.getResolution();c.default.assertNumber(i),this.syncDataSourcesToResolution_(i)}},{key:"syncDataSourcesToResolution_",value:function(e){var t=this;this.ngeoDataSources_.forEach(function(i){t.syncDataSourceToResolution_(i,e)})}},{key:"syncDataSourceToResolution_",value:function(e,t){if(e.supportsDynamicInRange){var i=e.maxResolution,n=e.minResolution,o=(null===n||void 0===n||t>=n)&&(null===i||void 0===i||t<=i);e.inRange=o}}},{key:"handleDataSourcesAdd_",value:function(e){var t=c.default.assertInstanceof(e.element,s.default);if(this.map_){var i=this.map_.getView().getResolution();c.default.assertNumber(i),this.syncDataSourceToResolution_(t,i)}}},{key:"map",set:function(e){this.map_&&this.unbindMap_(this.map_),this.map_=e,e&&this.bindMap_(e)}}]),e}();d.module=angular.module("ngeoSyncDataSourcesMap",[r.default.module.name]),d.module.service("ngeoSyncDataSourcesMap",d),o.default.module.requires.push(d.module.name),t.default=d},36:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(i(1)),o=(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);t.default=e}(i(0)),s(i(2)));function s(e){return e&&e.__esModule?e:{default:e}}var r=function(e,t){this.manager_=e,this.features_=null,this.index_=t};r.prototype.addFeature=function(e){this.manager_.addFeature(e,this.index_)},r.prototype.removeFeature=function(e){this.manager_.removeFeature(e,this.index_)},r.prototype.clear=function(){this.manager_.clear(this.index_)},r.prototype.setFeatures=function(e){null!==this.features_&&(this.features_.clear(),o.default.unlisten(this.features_,"add",this.handleFeatureAdd_,this),o.default.unlisten(this.features_,"remove",this.handleFeatureRemove_,this)),null!==e&&(e.forEach(function(e){this.addFeature(e)},this),o.default.listen(e,"add",this.handleFeatureAdd_,this),o.default.listen(e,"remove",this.handleFeatureRemove_,this)),this.features_=e},r.prototype.setStyle=function(e){this.manager_.setStyle(e,this.index_)},r.prototype.handleFeatureAdd_=function(e){var t=e.element;this.addFeature(t)},r.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature(t)},r.module=angular.module("ngeoFeatureOverlay",[]),n.default.module.requires.push(r.module.name),t.default=r},37:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=i(1),s=(n=o)&&n.__esModule?n:{default:n};var r=angular.module("ngeoRecenter",[]);s.default.module.requires.push(r.name),r.directive_=function(){return{restrict:"A",link:function(e,t,i){var n=i.ngeoRecenterMap,o=e.$eval(n);function s(t){var i=t.attr("ngeo-extent");if(void 0!==i){var n=o.getSize();o.getView().fit(e.$eval(i),{size:n})}var s=t.attr("ngeo-zoom");void 0!==s&&o.getView().setZoom(e.$eval(s))}t.on("click","*",function(e){s(angular.element($(this)))}),t.on("change",function(e){var t=e.target.options[e.target.selectedIndex];s(angular.element(t))})}}},r.directive("ngeoRecenter",r.directive_),t.default=r},38:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(i(3)),o=r(i(1)),s=r(i(7));function r(e){return e&&e.__esModule?e:{default:e}}var a=angular.module("ngeoResizemap",[]);o.default.module.requires.push(a.name),a.directive_=function(e){return{restrict:"A",link:function(t,i,o){var r=o.ngeoResizemap,a=t.$eval(r);n.default.assertInstanceof(a,s.default);var l=o.ngeoResizemapState;n.default.assert(void 0!==l);var u=void 0,c=void 0,h=function t(){a.updateSize(),a.renderSync(),Date.now()-u<1e3&&(c=e.requestAnimationFrame(t))};i.on("transitionend",function(){a.updateSize(),a.renderSync()}),t.$watch(l,function(t,i){t!=i&&(u=Date.now(),e.cancelAnimationFrame(c),c=e.requestAnimationFrame(h))})}}},a.directive("ngeoResizemap",a.directive_),t.default=a},39:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(1)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(8)),s=a(i(7)),r=a(i(2));function a(e){return e&&e.__esModule?e:{default:e}}var l=angular.module("ngeoScaleselector",[]);n.default.module.requires.push(l.name),l.value("ngeoScaleselectorTemplateUrl",function(e,t){var i=t.ngeoScaleselectorTemplateurl;return void 0!==i?i:n.default.baseModuleTemplateUrl+"/map/scaleselector.html"}),l.directive_=function(e){return{restrict:"A",scope:!0,controller:"NgeoScaleselectorController",templateUrl:e}},l.directive("ngeoScaleselector",l.directive_),l.ScaleselectorController_=function(e,t,i){var n=this,a=i.ngeoScaleselector;this.scales=e.$eval(a),goog.asserts.assert(void 0!==this.scales),this.zoomLevels,e.$watch(function(){return Object.keys(n.scales).length},function(e){n.zoomLevels=Object.keys(n.scales).map(Number),n.zoomLevels.sort(o.numberSafeCompareFunction)});var u=i.ngeoScaleselectorMap;this.map_=e.$eval(u),goog.asserts.assertInstanceof(this.map_,s.default);var c=i.ngeoScaleselectorOptions,h=e.$eval(c);if(this.options=l.ScaleselectorController_.getOptions_(h),this.$scope_=e,this.resolutionChangeKey_=null,this.currentScale=void 0,null!==this.map_.getView()){var d=this.map_.getView().getZoom();void 0!==d&&(this.currentScale=this.getScale(d))}r.default.listen(this.map_,"change:view",this.handleViewChange_,this),this.registerResolutionChangeListener_(),e.scaleselectorCtrl=this},l.ScaleselectorController_.getOptions_=function(e){var t=!1;return void 0!==e&&(t=1==e.dropup),{dropup:t}},l.ScaleselectorController_.prototype.getScale=function(e){return this.scales[e]},l.ScaleselectorController_.prototype.changeZoom=function(e){this.map_.getView().setZoom(e)},l.ScaleselectorController_.prototype.handleResolutionChange_=function(e){var t=this,i=this.map_.getView(),n=this.scales[i.getZoom()];void 0!==n&&this.$scope_.$applyAsync(function(){t.currentScale=n})},l.ScaleselectorController_.prototype.handleViewChange_=function(e){this.registerResolutionChangeListener_(),this.handleResolutionChange_(null)},l.ScaleselectorController_.prototype.registerResolutionChangeListener_=function(){null!==this.resolutionChangeKey_&&r.default.unlistenByKey(this.resolutionChangeKey_);var e=this.map_.getView();this.resolutionChangeKey_=r.default.listen(e,"change:resolution",this.handleResolutionChange_,this)},l.controller("NgeoScaleselectorController",l.ScaleselectorController_),t.default=l},398:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(399),i(59);var n=h(i(7)),o=h(i(31)),s=h(i(62)),r=h(i(48)),a=h(i(400)),l=h(i(1)),u=h(i(32)),c=h(i(403));function h(e){return e&&e.__esModule?e:{default:e}}app.module=angular.module("app",[l.default.module.name,u.default.name,a.default.name]),app.MainController=function(e,t){this.map=new n.default({layers:[new s.default({source:new r.default})],view:new o.default({center:[0,0],zoom:4})});this.ol3dm=new c.default("../node_modules/@camptocamp/cesium/Build/Cesium/Cesium.js",e,{map:this.map}),t.initialize(this.ol3dm)},app.module.controller("MainController",app.MainController),t.default={}},399:function(e,t){},400:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(i(401)),o=s(i(402));function s(e){return e&&e.__esModule?e:{default:e}}var r=angular.module("ngeoOlcsModule",[o.default.name,n.default.module.name]);t.default=r},401:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manager_}return n(e,[{key:"initialize",value:function(e){this.manager_=e}},{key:"getManager",value:function(){return this.manager_}}]),e}(),s="ngeoOlcsService";o.module=angular.module(s,[]).service(s,o);var r=o;t.default=r},402:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(117)),s=a(i(159)),r=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(t)return t;var i=e.ngeoOlcsControls3dTemplateUrl;return i||r.default.baseModuleTemplateUrl+"/olcs/controls3d.html"}l.$inject=["$attrs","ngeoOlcsControls3dTemplateUrl"];var u={bindings:{minTilt:"<?",maxTilt:"<?",ol3dm:"<?"},controller:function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element_=t,this.ol3dm,this.minTilt,this.maxTilt,this.tiltRightEl_,this.tiltLeftEl_,this.rotation3dEl_,this.angle3dEl_,this.previousRotation_,this.previousViewMatrix_,this.animationFrameRequestId_,this.olcsService_=i}return n(e,[{key:"updateWidget_",value:function(){var e,t,i=this,n=this.ol3dm.getOl3d().getOlView().getRotation();e=this.previousRotation_,t=n,Number.isFinite(t)&&(!Number.isFinite(e)||Math.abs(t-e)>.05)&&(this.rotateElement_(this.rotation3dEl_,n),this.previousRotation_=n);var o=this.ol3dm.getCesiumViewMatrix();if(!Cesium.Matrix4.equalsEpsilon(this.previousViewMatrix_,o,1e-5)){var s=this.ol3dm.getTiltOnGlobe();if(Number.isFinite(s||0)){this.rotateElement_(this.angle3dEl_,s),this.previousViewMatrix_=Cesium.Matrix4.clone(o);s-this.minTilt<.01?this.tiltRightEl_.addClass("ngeo-right-inactive"):this.tiltRightEl_.hasClass("ngeo-right-inactive")&&this.tiltRightEl_.removeClass("ngeo-right-inactive"),this.maxTilt-s<.01?this.tiltLeftEl_.addClass("ngeo-left-inactive"):this.tiltLeftEl_.hasClass("ngeo-left-inactive")&&this.tiltLeftEl_.removeClass("ngeo-left-inactive")}}this.animationFrameRequestId_=requestAnimationFrame(function(){return i.updateWidget_()})}},{key:"$onDestroy",value:function(){this.animationFrameRequestId_&&cancelAnimationFrame(this.animationFrameRequestId_)}},{key:"$onInit",value:function(){void 0===this.minTilt&&(this.minTilt=0),void 0===this.maxTilt&&(this.maxTilt=7*Math.PI/16),this.ol3dm||(this.ol3dm=goog.asserts.assert(this.olcsService_.getManager())),this.tiltRightEl_=this.element_.find(".ngeo-tilt-right"),this.tiltLeftEl_=this.element_.find(".ngeo-tilt-left"),this.rotation3dEl_=this.element_.find(".ngeo-rotation3d"),this.angle3dEl_=this.element_.find(".ngeo-angle3d"),this.updateWidget_()}},{key:"rotateElement_",value:function(e,t){var i="rotate("+t+"rad)";e.css({"-moz-transform":i,"-webkit-transform":i,"-o-transform":i,"-ms-transform":i,transform:i})}},{key:"rotate",value:function(e){e=Cesium.Math.toRadians(e),this.ol3dm.setHeading(e)}},{key:"tilt",value:function(e){e=Cesium.Math.toRadians(e);var t=this.ol3dm.getTiltOnGlobe();t+e<this.minTilt?e=this.minTilt-t:t+e>this.maxTilt&&(e=this.maxTilt-t);var i=this.ol3dm.getCesiumScene();s.default.rotateAroundBottomCenter(i,e)}},{key:"zoom",value:function(e){var t=this.ol3dm.getOlView(),i=t.getResolution(),n=t.constrainResolution(i,e);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:n,duration:250,easing:o.easeOut})}}]),e}(),templateUrl:l},c="ngeoOlcsControls3d",h=angular.module(c,[]).component(c,u).value("ngeoOlcsControls3dTemplateUrl","");r.default.module.requires.push(c),t.default=h},403:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(404),r=(n=s)&&n.__esModule?n:{default:n};var a=function(e){function t(e,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.rootScope_=i,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),o(t,[{key:"toggle3d",value:function(){var e=this;return function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toggle3d",this).call(this).then(function(){e.rootScope_.$apply()})}}]),t}();t.default=a},404:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=class{constructor(e){this.promise,this.url_=e}load(){return this.promise||(this.promise=new Promise((e,t)=>{const i=document.createElement("script");i.onload=(()=>e()),i.onerror=(()=>t()),document.head.appendChild(i),i.src=this.url_})),this.promise}},o=i(27),s=i(143),r=i.n(s),a=i(6),l=i(2),u=i(88);const c={obj:function(e){return e},supportsImageRenderingPixelatedResult_:void 0,imageRenderingValueResult_:void 0,supportsImageRenderingPixelated:function(){if(void 0===c.supportsImageRenderingPixelatedResult_){const e=document.createElement("canvas");e.setAttribute("style","image-rendering: -moz-crisp-edges; image-rendering: pixelated;");const t=e.style.imageRendering;c.supportsImageRenderingPixelatedResult_=!!t,c.supportsImageRenderingPixelatedResult_&&(c.imageRenderingValueResult_=t)}return c.supportsImageRenderingPixelatedResult_},imageRenderingValue:function(){return c.supportsImageRenderingPixelated(),c.imageRenderingValueResult_||""}};var h=c,d=i(159);const p=function(e,t){this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this.verboseRendering=t,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.lastCameraViewMatrix_=new Cesium.Matrix4,this.lastCameraMoveTime_=0,this.stoppedRendering=!1,this._removePostRenderListener=this.scene_.postRender.addEventListener(this.postRender.bind(this)),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"];const i=Cesium.Camera.prototype;this.interceptedAPIs_=[[i,"setView"],[i,"move"],[i,"rotate"],[i,"lookAt"],[i,"flyTo"],[i,"flyToHome"],[i,"flyToBoundingSphere"]],this.originalAPIs_=this.interceptedAPIs_.map(e=>e[0][e[1]]),this.originalLoadWithXhr_=Cesium.loadWithXhr.load,this.originalScheduleTask_=Cesium.TaskProcessor.prototype.scheduleTask,this.enable()};p.prototype.enable=function(){for(const e of this.repaintEventNames_)this.canvas_.addEventListener(e,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1);const e=this;Cesium.loadWithXhr.load=function(t,i,n,o,s,r,a,l,u){r.promise.always(e._boundNotifyRepaintRequired),e.originalLoadWithXhr_(...arguments)},Cesium.TaskProcessor.prototype.scheduleTask=function(t,i){const n=e.originalScheduleTask_.call(this,t,i),o=this;if(!o._originalWorkerMessageSinkRepaint){const t=o._worker;o._originalWorkerMessageSinkRepaint=t.onmessage,t.onmessage=function(t){o._originalWorkerMessageSinkRepaint(t),e.notifyRepaintRequired()}}return n};for(let t=0;t<this.interceptedAPIs_.length;++t){const i=this.interceptedAPIs_[t],n=i[0],o=this.originalAPIs_[t];n[i[1]]=function(...t){o.apply(this,t),e.notifyRepaintRequired()}}this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)},p.prototype.disable=function(){this._removePostRenderListener&&(this._removePostRenderListener(),this._removePostRenderListener=void 0);for(const e of this.repaintEventNames_)this.canvas_.removeEventListener(e,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),Cesium.loadWithXhr.load=this.originalLoadWithXhr_,Cesium.TaskProcessor.prototype.scheduleTask=this.originalScheduleTask_;for(let e=0;e<this.interceptedAPIs_.length;++e){const t=this.interceptedAPIs_[e],i=t[0],n=this.originalAPIs_[e];i[t[1]]=n}this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired)},p.prototype.postRender=function(e){const t=Date.now(),i=this.scene_,n=i.camera;Cesium.Matrix4.equalsEpsilon(this.lastCameraViewMatrix_,n.viewMatrix,1e-5)||(this.lastCameraMoveTime_=t);const o=t-this.lastCameraMoveTime_<1e3,s=i.globe._surface,r=!s.tileProvider.ready||s._tileLoadQueueHigh.length>0||s._tileLoadQueueMedium.length>0||s._tileLoadQueueLow.length>0||s._debug.tilesWaitingForChildren>0,a=i.tweens;o||r||0!=a.length||(this.verboseRendering&&console.log(`stopping rendering @ ${Date.now()}`),this.ol3d.setBlockCesiumRendering(!0),this.stoppedRendering=!0),Cesium.Matrix4.clone(n.viewMatrix,this.lastCameraViewMatrix_)},p.prototype.restartRenderLoop=function(){this.notifyRepaintRequired()},p.prototype.notifyRepaintRequired=function(){this.verboseRendering&&this.stoppedRendering&&console.log(`starting rendering @ ${Date.now()}`),this.lastCameraMoveTime_=Date.now(),this.ol3d.setBlockCesiumRendering(!1),this.stoppedRendering=!1},p.prototype.setDebug=function(e){this.verboseRendering=e};var m=p,f=i(19),g=i(14);const _=function(e,t){this.scene_=e,this.cam_=e.camera,this.map_=t,this.view_=null,this.viewListenKey_=null,this.toLonLat_=_.identityProjection,this.fromLonLat_=_.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",function(e){this.setView_(this.map_.getView())},this),this.setView_(this.map_.getView())};_.identityProjection=function(e,t,i){const n=i||e.length;if(t)for(let i=0;i<n;++i)t[i]=e[i];return e},_.prototype.setView_=function(e){if(this.view_&&(f.default.unByKey(this.viewListenKey_),this.viewListenKey_=null),this.view_=e,e){const t=a.default.getTransform(e.getProjection(),"EPSG:4326"),i=a.default.getTransform("EPSG:4326",e.getProjection());r.a.assert(t&&i),this.toLonLat_=t,this.fromLonLat_=i,this.viewListenKey_=l.default.listen(e,"propertychange",this.handleViewEvent_,this),this.readFromView()}else this.toLonLat_=_.identityProjection,this.fromLonLat_=_.identityProjection},_.prototype.handleViewEvent_=function(e){this.viewUpdateInProgress_||this.readFromView()},_.prototype.setHeading=function(e){this.view_&&this.view_.setRotation(e)},_.prototype.getHeading=function(){if(!this.view_)return;return this.view_.getRotation()||0},_.prototype.setTilt=function(e){this.tilt_=e,this.updateCamera_()},_.prototype.getTilt=function(){return this.tilt_},_.prototype.setDistance=function(e){this.distance_=e,this.updateCamera_(),this.updateView()},_.prototype.getDistance=function(){return this.distance_},_.prototype.setCenter=function(e){this.view_&&this.view_.setCenter(e)},_.prototype.getCenter=function(){if(this.view_)return this.view_.getCenter()},_.prototype.setPosition=function(e){if(!this.toLonLat_)return;const t=this.toLonLat_(e);r.a.assert(t);const i=new Cesium.Cartographic(g.default.toRadians(t[0]),g.default.toRadians(t[1]),this.getAltitude());this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),this.updateView()},_.prototype.getPosition=function(){if(!this.fromLonLat_)return;const e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),t=this.fromLonLat_([g.default.toDegrees(e.longitude),g.default.toDegrees(e.latitude)]);return r.a.assert(t),t},_.prototype.setAltitude=function(e){const t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);t.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),this.updateView()},_.prototype.getAltitude=function(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height},_.prototype.lookAt=function(e){if(!this.toLonLat_)return;const t=this.toLonLat_(e);r.a.assert(t);const i=Cesium.Cartographic.fromDegrees(t[0],t[1]);d.default.lookAt(this.cam_,i,this.scene_.globe),this.updateView()},_.prototype.updateCamera_=function(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(!e)return;const t=this.toLonLat_(e);r.a.assert(t);const i=new Cesium.Cartographic(g.default.toRadians(t[0]),g.default.toRadians(t[1]));if(this.scene_.globe){const e=this.scene_.globe.getHeight(i);i.height=e||0}const n=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),o={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:n,orientation:o}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)},_.prototype.readFromView=function(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(void 0===e||null===e)return;const t=this.toLonLat_(e);r.a.assert(t);const i=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(i||0,g.default.toRadians(t[1])),this.updateCamera_()},_.prototype.updateView=function(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const e=Cesium.Ellipsoid.WGS84,t=this.scene_,i=d.default.pickCenterPoint(t);let n=i;if(!n){const e=t.globe,i=this.cam_.positionCartographic.clone(),o=e.getHeight(i);i.height=o||0,n=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}this.distance_=Cesium.Cartesian3.distance(n,this.cam_.position);const o=e.cartesianToCartographic(n);if(this.view_.setCenter(this.fromLonLat_([g.default.toDegrees(o.longitude),g.default.toDegrees(o.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,o?o.latitude:0)),i){const t=this.cam_.position,n=new Cesium.Cartesian3;e.geocentricSurfaceNormal(i,n);const o=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(t,i,o),Cesium.Cartesian3.normalize(o,o);const s=this.cam_.up,r=this.cam_.right,a=new Cesium.Cartesian3(-i.y,i.x,0),l=Cesium.Cartesian3.angleBetween(r,a),u=Cesium.Cartesian3.cross(i,s,new Cesium.Cartesian3).z;this.view_.setRotation(u<0?l:-l);const c=Math.acos(Cesium.Cartesian3.dot(n,o));this.tilt_=isNaN(c)?0:c}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1},_.prototype.checkCameraChange=function(e){const t=this.lastCameraViewMatrix_,i=this.cam_.viewMatrix;t&&Cesium.Matrix4.equalsEpsilon(t,i,1e-5)||(this.lastCameraViewMatrix_=i.clone(),!0!==e&&this.updateView())},_.prototype.calcDistanceForResolution=function(e,t){const i=this.scene_.canvas,n=this.cam_.frustum.fovy;r.a.assert(!isNaN(n));const o=this.view_.getProjection().getMetersPerUnit();return e*i.clientHeight*o*Math.cos(Math.abs(t))/2/Math.tan(n/2)},_.prototype.calcResolutionForDistance=function(e,t){const i=this.scene_.canvas,n=this.cam_.frustum.fovy,o=this.view_.getProjection().getMetersPerUnit();return 2*e*Math.tan(n/2)/o/Math.cos(Math.abs(t))/i.clientHeight};var y=_,v=i(52),C=i(8),S=i(0);const b=function(e,t){this.map=e,this.view=e.getView(),this.scene=t,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}};b.prototype.synchronize=function(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)},b.prototype.orderLayers=function(){},b.prototype.addLayers_=function(e){const t=[{layer:e,parents:[]}];for(;t.length>0;){const e=t.splice(0,1)[0],i=e.layer,n=S.default.getUid(i).toString();this.olLayerListenKeys[n]=[],r.a.assert(!this.layerMap[n]);let o=null;i instanceof v.default?(this.listenForGroupChanges_(i),i!==this.mapLayerGroup&&(o=this.createSingleLayerCounterparts(e)),o||i.getLayers().forEach(n=>{if(n){const o={layer:n,parents:i===this.mapLayerGroup?[]:[e.layer].concat(e.parents)};t.push(o)}})):o=this.createSingleLayerCounterparts(e),o&&(this.layerMap[n]=o,this.olLayerListenKeys[n].push(l.default.listen(i,"change:zIndex",this.orderLayers,this)),o.forEach(function(e){this.addCesiumObject(e)},this))}this.orderLayers()},b.prototype.removeAndDestroySingleLayer_=function(e){const t=S.default.getUid(e).toString(),i=this.layerMap[t];return i&&(i.forEach(function(e){this.removeSingleCesiumObject(e,!1),this.destroyCesiumObject(e)},this),this.olLayerListenKeys[t].forEach(f.default.unByKey),delete this.olLayerListenKeys[t]),delete this.layerMap[t],!!i},b.prototype.unlistenSingleGroup_=function(e){if(e===this.mapLayerGroup)return;const t=S.default.getUid(e).toString();this.olGroupListenKeys_[t].forEach(e=>{f.default.unByKey(e)}),delete this.olGroupListenKeys_[t],delete this.layerMap[t]},b.prototype.removeLayer_=function(e){if(e){const t=[e];for(;t.length>0;){const e=t.splice(0,1)[0],i=this.removeAndDestroySingleLayer_(e);e instanceof v.default&&(this.unlistenSingleGroup_(e),i||e.getLayers().forEach(e=>{t.push(e)}))}}},b.prototype.listenForGroupChanges_=function(e){const t=S.default.getUid(e).toString();r.a.assert(void 0===this.olGroupListenKeys_[t]);const i=[];this.olGroupListenKeys_[t]=i;let n=[];const o=function(){const t=e.getLayers();t&&(n=[t.on("add",function(e){this.addLayers_(e.element)},this),t.on("remove",function(e){this.removeLayer_(e.element)},this)],i.push(...n))}.bind(this);o(),i.push(e.on("change:layers",e=>{n.forEach(e=>{const t=i.indexOf(e);t>=0&&i.splice(t,1),f.default.unByKey(e)}),o()}))},b.prototype.destroyAll=function(){let e;this.removeAllCesiumObjects(!0);for(e in this.olGroupListenKeys_){this.olGroupListenKeys_[e].forEach(f.default.unByKey)}for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(f.default.unByKey);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}},b.prototype.addCesiumObject=function(e){},b.prototype.destroyCesiumObject=function(e){},b.prototype.removeSingleCesiumObject=function(e,t){},b.prototype.removeAllCesiumObjects=function(e){},b.prototype.createSingleLayerCounterparts=function(e){};var E=b;const R=function(e,t){this.cesiumLayers_=t.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection,E.call(this,e,t)};S.default.inherits(R,E),R.prototype.addCesiumObject=function(e){this.cesiumLayers_.add(e),this.ourLayers_.add(e)},R.prototype.destroyCesiumObject=function(e){e.destroy()},R.prototype.removeSingleCesiumObject=function(e,t){this.cesiumLayers_.remove(e,t),this.ourLayers_.remove(e,!1)},R.prototype.removeAllCesiumObjects=function(e){for(let t=0;t<this.ourLayers_.length;++t)this.cesiumLayers_.remove(this.ourLayers_.get(t),e);this.ourLayers_.removeAll(!1)},R.prototype.convertLayerToCesiumImageries=function(e,t){const i=d.default.tileLayerToImageryLayer(e,t);return i?[i]:null},R.prototype.createSingleLayerCounterparts=function(e){const t=e.layer,i=S.default.getUid(t).toString(),n=this.view.getProjection();r.a.assert(n);const o=this.convertLayerToCesiumImageries(t,n);if(o){const n=[];[e.layer].concat(e.parents).forEach(t=>{n.push(t.on(["change:opacity","change:visible"],()=>{r.a.assert(o);for(let t=0;t<o.length;++t)d.default.updateCesiumLayerProperties(e,o[t])}))});for(let t=0;t<o.length;++t)d.default.updateCesiumLayerProperties(e,o[t]);n.push(t.on("change:extent",function(e){for(let e=0;e<o.length;++e)this.cesiumLayers_.remove(o[e],!0),this.ourLayers_.remove(o[e],!1);delete this.layerMap[S.default.getUid(t)],this.synchronize()},this)),n.push(t.on("change",function(e){for(let e=0;e<o.length;++e){const t=this.cesiumLayers_.indexOf(o[e]);t>=0&&(this.cesiumLayers_.remove(o[e],!1),this.cesiumLayers_.add(o[e],t))}},this)),this.olLayerListenKeys[i].push(...n)}return Array.isArray(o)?o:null},R.prototype.orderLayers=function(){const e=[],t={},i=[this.mapLayerGroup];for(;i.length>0;){const n=i.splice(0,1)[0];if(e.push(n),t[S.default.getUid(n)]=n.getZIndex(),n instanceof v.default){const e=n.getLayers();e&&i.unshift(...e.getArray())}}C.default.stableSort(e,(e,i)=>t[S.default.getUid(e)]-t[S.default.getUid(i)]),e.forEach(function(e){const t=S.default.getUid(e).toString(),i=this.layerMap[t];i&&i.forEach(this.raiseToTop,this)},this)},R.prototype.raiseToTop=function(e){this.cesiumLayers_.raiseToTop(e)};var T=R,O=i(18),w=i(50),L=i(10),P=i(40),A=i(86),M=i(9),F=i(4);const I=function(e){O.default.call(this,{attributions:e.attributions,extent:e.extent,projection:e.projection,wrapX:e.wrapX}),this.resolution=void 0,this.distance=void 0!==e.distance?e.distance:20,this.features=[],this.geometryFunction=e.geometryFunction||function(e){const t=e.getGeometry();return Object(L.a)(t instanceof o.default,10),t},this.source=e.source,this.source.on(M.a.CHANGE,I.prototype.refresh,this)};Object(S.inherits)(I,O.default),I.prototype.getDistance=function(){return this.distance},I.prototype.getSource=function(){return this.source},I.prototype.loadFeatures=function(e,t,i){this.source.loadFeatures(e,t,i),t!==this.resolution&&(this.clear(),this.resolution=t,this.cluster(),this.addFeatures(this.features))},I.prototype.setDistance=function(e){this.distance=e,this.refresh()},I.prototype.refresh=function(){this.clear(),this.cluster(),this.addFeatures(this.features),O.default.prototype.refresh.call(this)},I.prototype.cluster=function(){if(void 0===this.resolution)return;this.features.length=0;const e=Object(F.createEmpty)(),t=this.distance*this.resolution,i=this.source.getFeatures(),n={};for(let o=0,s=i.length;o<s;o++){const s=i[o];if(!(Object(S.getUid)(s).toString()in n)){const i=this.geometryFunction(s);if(i){const o=i.getCoordinates();Object(F.createOrUpdateFromCoordinate)(o,e),Object(F.buffer)(e,t,e);let s=this.source.getFeaturesInExtent(e);s=s.filter(function(e){const t=Object(S.getUid)(e).toString();return!(t in n)&&(n[t]=!0,!0)}),this.features.push(this.createCluster(s))}}}},I.prototype.createCluster=function(e){const t=[0,0];for(let i=e.length-1;i>=0;--i){const n=this.geometryFunction(e[i]);n?A.default.add(t,n.getCoordinates()):e.splice(i,1)}A.default.scale(t,1/e.length);const i=new P.default(new o.default(t));return i.set("features",e),i};var x=I,j=i(110),G=i(20),k=i(82),N=i(147),V=i(44);const D=function(e,t){const i=new Cesium.BillboardCollection({scene:t}),n=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:i,featureToCesiumMap:{},primitives:n},this.rootCollection_.add(i),this.rootCollection_.add(n)};D.prototype.destroy=function(){this.olListenKeys.forEach(f.default.unByKey),this.olListenKeys.length=0},D.prototype.getRootPrimitive=function(){return this.rootCollection_};var U=D;const B=function(e){this.scene=e,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this)};B.prototype.onRemoveOrClearFeature_=function(e){const t=e.target;r.a.assertInstanceof(t,O.default);const i=h.obj(t).olcs_cancellers;if(i){const n=e.feature;if(n){const e=S.default.getUid(n),t=i[e];t&&(t(),delete i[e])}else{for(const e in i)i.hasOwnProperty(e)&&i[e]();h.obj(t).olcs_cancellers={}}}},B.prototype.setReferenceForPicking=function(e,t,i){i.olLayer=e,i.olFeature=t},B.prototype.createColoredPrimitive=function(e,t,i,n,o,s){const r={flat:!0,renderState:{depthTest:{enabled:!0}}};void 0!==s&&(r.renderState||(r.renderState={}),r.renderState.lineWidth=s);const a=(l=n,u=o,new Cesium.GeometryInstance({geometry:l,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(u)}}));var l,u;let c;if(this.getHeightReference(e,t,i)==Cesium.HeightReference.CLAMP_TO_GROUND){const e=a.geometry.constructor;if(e&&!e.createShadowVolume)return null;c=new Cesium.GroundPrimitive({geometryInstances:a})}else{const e=new Cesium.PerInstanceColorAppearance(r);c=new Cesium.Primitive({geometryInstances:a,appearance:e})}return this.setReferenceForPicking(e,t,c),c},B.prototype.extractColorFromOlStyle=function(e,t){const i=e.getFill()?e.getFill().getColor():null,n=e.getStroke()?e.getStroke().getColor():null;let o="black";return n&&t?o=n:i&&(o=i),d.default.convertColorToCesium(o)},B.prototype.extractLineWidthFromOlStyle=function(e){const t=e.getStroke()?e.getStroke().getWidth():void 0;return void 0!==t?t:1},B.prototype.wrapFillAndOutlineGeometries=function(e,t,i,n,o,s){const a=this.extractColorFromOlStyle(s,!1),l=this.extractColorFromOlStyle(s,!0),u=new Cesium.PrimitiveCollection;if(s.getFill()){const o=this.createColoredPrimitive(e,t,i,n,a);r.a.assert(!!o),u.add(o)}if(s.getStroke()){const n=this.extractLineWidthFromOlStyle(s),r=this.createColoredPrimitive(e,t,i,o,l,n);r&&u.add(r)}return u},B.prototype.addTextStyle=function(e,t,i,n,o){let s;if(o instanceof Cesium.PrimitiveCollection?s=o:(s=new Cesium.PrimitiveCollection).add(o),!n.getText())return s;const r=n.getText(),a=this.olGeometry4326TextPartToCesium(e,t,i,r);return a&&s.add(a),s},B.prototype.csAddBillboard=function(e,t,i,n,o,s){const r=e.add(t);return this.setReferenceForPicking(i,n,r),r},B.prototype.olCircleGeometryToCesium=function(e,t,i,n,o){i=d.default.olGeometryCloneTo4326(i,n),r.a.assert("Circle"==i.getType());let s=i.getCenter();const a=3==s.length?s[2]:0;let l=s.slice();l[0]+=i.getRadius(),s=d.default.ol4326CoordinateToCesiumCartesian(s),l=d.default.ol4326CoordinateToCesiumCartesian(l);const u=Cesium.Cartesian3.distance(s,l),c=new Cesium.CircleGeometry({center:s,radius:u,height:a}),h=new Cesium.CircleOutlineGeometry({center:s,radius:u,extrudedHeight:a,height:a}),p=this.wrapFillAndOutlineGeometries(e,t,i,c,h,o);return this.addTextStyle(e,t,i,o,p)},B.prototype.olLineStringGeometryToCesium=function(e,t,i,n,o){i=d.default.olGeometryCloneTo4326(i,n),r.a.assert("LineString"==i.getType());const s=d.default.ol4326CoordinateArrayToCsCartesians(i.getCoordinates()),a=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,o,!0)}),l={positions:s,width:this.extractLineWidthFromOlStyle(o),vertexFormat:a.vertexFormat};let u;if(this.getHeightReference(e,t,i)==Cesium.HeightReference.CLAMP_TO_GROUND){const e=this.extractColorFromOlStyle(o,!0);u=new Cesium.GroundPrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(l),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(e)}})})}else u=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry(l)}),appearance:a});return this.setReferenceForPicking(e,t,u),this.addTextStyle(e,t,i,o,u)},B.prototype.olPolygonGeometryToCesium=function(e,t,i,n,o){let s,a;if(i=d.default.olGeometryCloneTo4326(i,n),r.a.assert("Polygon"==i.getType()),5==i.getCoordinates()[0].length&&"rectangle"===t.getGeometry().get("olcs.polygon_kind")){const e=i.getCoordinates()[0],t=F.default.boundingExtent(e),n=Cesium.Rectangle.fromDegrees(t[0],t[1],t[2],t[3]);let o=0;if(3==e[0].length)for(let t=0;t<e.length;t++)o=Math.max(o,e[t][2]);s=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:n,height:o}),a=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:n,height:o})}else{const e=i.getLinearRings(),t={},n=t;r.a.assert(e.length>0);for(let i=0;i<e.length;++i){const n=e[i].getCoordinates(),o=d.default.ol4326CoordinateArrayToCsCartesians(n);r.a.assert(o&&o.length>0),0==i?t.positions=o:(t.holes||(t.holes=[]),t.holes.push({positions:o}))}s=new Cesium.PolygonGeometry({polygonHierarchy:n,perPositionHeight:!0}),a=new Cesium.PolygonOutlineGeometry({polygonHierarchy:t,perPositionHeight:!0})}const l=this.wrapFillAndOutlineGeometries(e,t,i,s,a,o);return this.addTextStyle(e,t,i,o,l)},B.prototype.getHeightReference=function(e,t,i){let n=i.get("altitudeMode");void 0===n&&(n=t.get("altitudeMode")),void 0===n&&(n=e.get("altitudeMode"));let o=Cesium.HeightReference.NONE;return"clampToGround"===n?o=Cesium.HeightReference.CLAMP_TO_GROUND:"relativeToGround"===n&&(o=Cesium.HeightReference.RELATIVE_TO_GROUND),o},B.prototype.olPointGeometryToCesium=function(e,t,i,n,o,s,a){r.a.assert("Point"==i.getType()),i=d.default.olGeometryCloneTo4326(i,n);const u=o.getImage();if(u){u instanceof N.default&&u.load();const n=u.getImage(1),r=function(e){return""!=e.src&&0!=e.naturalHeight&&0!=e.naturalWidth&&e.complete},c=function(){if(!n)return;if(!(n instanceof HTMLCanvasElement||n instanceof Image||n instanceof HTMLImageElement))return;const r=i.getCoordinates(),l=d.default.ol4326CoordinateToCesiumCartesian(r);let c;const h=u.getOpacity();void 0!==h&&(c=new Cesium.Color(1,1,1,h));const p=this.getHeightReference(e,t,i),m={image:n,color:c,scale:u.getScale(),heightReference:p,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,position:l},f=this.csAddBillboard(s,m,e,t,i,o);a&&a(f)}.bind(this);if(n instanceof Image&&!r(n)){let i=!1;const o=e.getSource(),r=function(){i=!0};o.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let a=h.obj(o).olcs_cancellers;a||(a=h.obj(o).olcs_cancellers={});const u=S.default.getUid(t);a[u]&&a[u](),a[u]=r;const d=function(){s.isDestroyed()||i||c()};l.default.listenOnce(n,"load",d)}else c()}return o.getText()?this.addTextStyle(e,t,i,o,new Cesium.Primitive):null},B.prototype.olMultiGeometryToCesium=function(e,t,i,n,o,s,a){const l=function(i,s){const r=new Cesium.PrimitiveCollection;return i.forEach(i=>{r.add(s(e,t,i,n,o))}),r};let u;switch(i.getType()){case"MultiPoint":if(u=(i=i).getPoints(),o.getText()){const i=new Cesium.PrimitiveCollection;return u.forEach(l=>{r.a.assert(l);const u=this.olPointGeometryToCesium(e,t,l,n,o,s,a);u&&i.add(u)}),i}return u.forEach(i=>{r.a.assert(i),this.olPointGeometryToCesium(e,t,i,n,o,s,a)}),null;case"MultiLineString":return l(u=(i=i).getLineStrings(),this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return l(u=(i=i).getPolygons(),this.olPolygonGeometryToCesium.bind(this));default:r.a.fail(`Unhandled multi geometry type${i.getType()}`)}},B.prototype.olGeometry4326TextPartToCesium=function(e,t,i,n){const o=n.getText();r.a.assert(void 0!==o);const s=new Cesium.LabelCollection({scene:this.scene}),a=F.default.getCenter(i.getExtent());if(i instanceof V.a){const e=i.getFirstCoordinate();a[2]=3==e.length?e[2]:0}const l={};l.position=d.default.ol4326CoordinateToCesiumCartesian(a),l.text=o,l.heightReference=this.getHeightReference(e,t,i);const u=n.getOffsetX(),c=n.getOffsetY();if(0!=u&&0!=c){const e=new Cesium.Cartesian2(u,c);l.pixelOffset=e}const h=n.getFont();void 0!==h&&(l.font=h);let p,m=void 0;switch(n.getFill()&&(l.fillColor=this.extractColorFromOlStyle(n,!1),m=Cesium.LabelStyle.FILL),n.getStroke()&&(l.outlineWidth=this.extractLineWidthFromOlStyle(n),l.outlineColor=this.extractColorFromOlStyle(n,!0),m=Cesium.LabelStyle.OUTLINE),n.getFill()&&n.getStroke()&&(m=Cesium.LabelStyle.FILL_AND_OUTLINE),l.style=m,n.getTextAlign()){case"left":p=Cesium.HorizontalOrigin.LEFT;break;case"right":p=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:p=Cesium.HorizontalOrigin.CENTER}if(l.horizontalOrigin=p,n.getTextBaseline()){let e;switch(n.getTextBaseline()){case"top":e=Cesium.VerticalOrigin.TOP;break;case"middle":e=Cesium.VerticalOrigin.CENTER;break;case"bottom":e=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":e=Cesium.VerticalOrigin.TOP;break;case"hanging":e=Cesium.VerticalOrigin.BOTTOM;break;default:r.a.fail(`unhandled baseline ${n.getTextBaseline()}`)}l.verticalOrigin=e}const f=s.add(l);return this.setReferenceForPicking(e,t,f),s},B.prototype.olStyleToCesium=function(e,t,i){const n=t.getFill(),o=t.getStroke();if(i&&!o||!i&&!n)return null;let s=i?o.getColor():n.getColor();return s=d.default.convertColorToCesium(s),i&&o.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:s,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:s})},B.prototype.computePlainStyle=function(e,t,i,n){const o=t.getStyleFunction();let s=null;return o&&(s=o.call(t,n)),!s&&i&&(s=i(t,n)),s?Array.isArray(s)?s:[s]:null},B.prototype.getGeometryFromFeature=function(e,t,i){if(i)return i;const n=e.get("olcs.3d_geometry");if(n&&n instanceof k.default)return n;if(t){const i=t.getGeometryFunction()(e);if(i instanceof k.default)return i}return e.getGeometry()},B.prototype.olFeatureToCesium=function(e,t,i,n,o){let s=this.getGeometryFromFeature(t,i,o);if(!s)return null;const r=n.projection,a=function(e){n.featureToCesiumMap[S.default.getUid(t)]=e};switch(s.getType()){case"GeometryCollection":const o=new Cesium.PrimitiveCollection;return s.getGeometries().forEach(s=>{if(s){const r=this.olFeatureToCesium(e,t,i,n,s);r&&o.add(r)}}),o;case"Point":s=s;const l=n.billboards,u=this.olPointGeometryToCesium(e,t,s,r,i,l,a);return u||null;case"Circle":return s=s,this.olCircleGeometryToCesium(e,t,s,r,i);case"LineString":return s=s,this.olLineStringGeometryToCesium(e,t,s,r,i);case"Polygon":return s=s,this.olPolygonGeometryToCesium(e,t,s,r,i);case"MultiPoint":case"MultiLineString":case"MultiPolygon":const c=this.olMultiGeometryToCesium(e,t,s,r,i,n.billboards,a);return c||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${s.getType()}`)}},B.prototype.olVectorLayerToCesium=function(e,t,i){const n=t.getProjection(),o=t.getResolution();if(void 0===o||!n)throw r.a.fail("View not ready"),new Error("View not ready");let s=e.getSource();s instanceof x&&(s=s.getSource()),r.a.assertInstanceof(s,O.default);const a=s.getFeatures(),l=new U(n,this.scene),u=l.context;for(let t=0;t<a.length;++t){const n=a[t];if(!n)continue;const s=e.getStyleFunction(),r=this.computePlainStyle(e,n,s,o);if(!r||!r.length)continue;let c=null;for(let t=0;t<r.length;t++){const i=this.olFeatureToCesium(e,n,r[t],u);if(i)if(c){if(i){let e,t=0;for(;e=i.get(t);)c.add(e),t++}}else c=i}c&&(i[S.default.getUid(n)]=c,l.getRootPrimitive().add(c))}return l},B.prototype.convert=function(e,t,i,n){const o=t.getProjection(),s=t.getResolution();if(void 0==s||!o)return null;const r=e.getStyleFunction(),a=this.computePlainStyle(e,i,r,s);if(!a.length)return null;n.projection=o;let l=null;for(let t=0;t<a.length;t++){const o=this.olFeatureToCesium(e,i,a[t],n);if(l){if(o){let e,t=0;for(;e=o.get(t);)l.add(e),t++}}else l=o}return l};var z=B;const W=function(e,t,i){this.converter=i||new z(t),this.csAllPrimitives_=new Cesium.PrimitiveCollection,t.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1,E.call(this,e,t)};S.default.inherits(W,E),W.prototype.addCesiumObject=function(e){r.a.assert(e),e.getRootPrimitive().counterpart=e,this.csAllPrimitives_.add(e.getRootPrimitive())},W.prototype.destroyCesiumObject=function(e){e.getRootPrimitive().destroy()},W.prototype.removeSingleCesiumObject=function(e,t){e.destroy(),this.csAllPrimitives_.destroyPrimitives=t,this.csAllPrimitives_.remove(e.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1},W.prototype.removeAllCesiumObjects=function(e){if(this.csAllPrimitives_.destroyPrimitives=e,e)for(let e=0;e<this.csAllPrimitives_.length;++e)this.csAllPrimitives_.get(e).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1},W.prototype.updateLayerVisibility=function(e,t){let i=!0;[e.layer].concat(e.parents).forEach(e=>{const t=e.getVisible();void 0!==t?i&=t:i=!1}),t.show=i},W.prototype.createSingleLayerCounterparts=function(e){const t=e.layer;if(!(t instanceof G.default))return null;r.a.assertInstanceof(t,w.default);let i=t.getSource();i instanceof x&&(i=i.getSource()),r.a.assertInstanceof(i,O.default),r.a.assert(this.view);const n=this.view,o={},s=this.converter.olVectorLayerToCesium(t,n,o),a=s.getRootPrimitive(),u=s.olListenKeys;[e.layer].concat(e.parents).forEach(t=>{u.push(l.default.listen(t,"change:visible",()=>{this.updateLayerVisibility(e,a)}))}),this.updateLayerVisibility(e,a);const c=function(e){r.a.assert(t instanceof G.default||t instanceof j.default);const i=s.context,l=this.converter.convert(t,n,e,i);l&&(o[S.default.getUid(e)]=l,a.add(l))}.bind(this),h=function(e){const t=e.getGeometry(),i=S.default.getUid(e);if(!t||"Point"==t.getType()){const e=s.context,t=e.featureToCesiumMap[i];delete e.featureToCesiumMap[i],t instanceof Cesium.Billboard&&e.billboards.remove(t)}const n=o[i];delete o[i],n&&a.remove(n)}.bind(this);return u.push(l.default.listen(i,"addfeature",e=>{r.a.assert(e.feature),c(e.feature)},this)),u.push(l.default.listen(i,"removefeature",e=>{r.a.assert(e.feature),h(e.feature)},this)),u.push(l.default.listen(i,"changefeature",e=>{const t=e.feature;r.a.assert(t),h(t),c(t)},this)),s?[s]:null};var H=W,K=i(140),q=i(68);const $=function(e){this.scenePostRenderListenerRemover_=null,this.scene_=e.scene,this.synchronizer_=e.synchronizer,this.parent_=e.parent,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[],this.listenerKeys_.push(this.parent_.on("change:position",this.setPropertyFromEvent_.bind(this))),this.listenerKeys_.push(this.parent_.on("change:element",this.setPropertyFromEvent_.bind(this))),this.listenerKeys_.push(this.parent_.on("change:offset",this.setPropertyFromEvent_.bind(this))),this.listenerKeys_.push(this.parent_.on("change:position",this.setPropertyFromEvent_.bind(this))),this.listenerKeys_.push(this.parent_.on("change:positioning",this.setPropertyFromEvent_.bind(this))),K.default.call(this,this.parent_.getOptions()),this.setProperties(this.parent_.getProperties()),this.handleMapChanged()};S.default.inherits($,K.default),$.prototype.observeTarget_=function(e){this.observer_.disconnect(),this.observer_.observe(e,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(e=>{e.disconnect()}),this.attributeObserver_.length=0;for(let t=0;t<e.childNodes.length;t++){const i=e.childNodes[t];if(1===i.nodeType){const e=new MutationObserver(this.handleElementChanged.bind(this));e.observe(i,{attributes:!0,subtree:!0}),this.attributeObserver_.push(e)}}},$.prototype.setPropertyFromEvent_=function(e){e.target&&e.key&&this.set(e.key,e.target.get(e.key))},$.prototype.getScene=function(){return this.scene_},$.prototype.handleMapChanged=function(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),q.default.removeNode(this.element)),this.scenePostRenderListenerRemover_=null;const e=this.getScene();if(e){this.scenePostRenderListenerRemover_=e.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const t=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element)}},$.prototype.handlePositionChanged=function(){const e=this.getPosition();if(e){const t=this.parent_.getMap().getView().getProjection();this.positionWGS84_=a.default.transform(e,t,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()},$.prototype.handleElementChanged=function(){function e(t,i){const n=t.cloneNode();i&&i.appendChild(n),t.nodeType!=Node.TEXT_NODE&&n.addEventListener("click",e=>{t.dispatchEvent(new MouseEvent("click",e)),e.stopPropagation()});const o=t.childNodes;for(let t=0;t<o.length;t++)o[t]&&e(o[t],n);return n}q.default.removeChildren(this.element);const t=this.getElement();if(t&&t.parentNode&&t.parentNode.childNodes)for(const i of t.parentNode.childNodes){const t=e(i,null);this.element.appendChild(t)}t.parentNode&&this.observeTarget_(t.parentNode)},$.prototype.updatePixelPosition=function(){const e=this.positionWGS84_;if(!this.scene_||!e)return void this.setVisible(!1);let t;t=2===e.length?Cesium.Cartesian3.fromDegreesArray(e)[0]:Cesium.Cartesian3.fromDegreesArrayHeights(e)[0];const i=this.scene_.camera,n=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(n,i.position).isPointVisible(t))return void this.setVisible(!1);if(1!==i.frustum.computeCullingVolume(i.position,i.direction,i.up).computeVisibility(new Cesium.BoundingSphere(t)))return void this.setVisible(!1);this.setVisible(!0);const o=this.scene_.cartesianToCanvasCoordinates(t),s=[o.x,o.y],r=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(s,r)},$.prototype.destroy=function(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),f.default.unByKey(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null};var Z=$;const X=function(e,t){this.map=e,this.overlays_=this.map.getOverlays(),this.scene=t,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",[l.default.EventType.CLICK,l.default.EventType.DBLCLICK,l.default.EventType.MOUSEDOWN,l.default.EventType.TOUCHSTART,l.default.EventType.MSPOINTERDOWN,S.default.MapBrowserEventType.POINTERDOWN,l.default.EventType.MOUSEWHEEL,l.default.EventType.WHEEL].forEach(e=>{l.default.listen(this.overlayContainerStopEvent_,e,l.default.Event.stopPropagation)}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}};X.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},X.prototype.getOverlayContainer=function(){return this.overlayContainer_},X.prototype.synchronize=function(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))},X.prototype.addOverlayFromEvent_=function(e){const t=e.element;this.addOverlay(t)},X.prototype.addOverlays=function(){this.overlays_.forEach(this.addOverlay,this)},X.prototype.addOverlay=function(e){if(!e)return;const t=new Z({scene:this.scene,synchronizer:this,parent:e}),i=S.default.getUid(e).toString();this.overlayMap_[i]=t},X.prototype.removeOverlayFromEvent_=function(e){const t=e.element;this.removeOverlay(t)},X.prototype.removeOverlay=function(e){const t=S.default.getUid(e).toString(),i=this.overlayMap_[t];i&&(i.destroy(),delete this.overlayMap_[t])},X.prototype.destroyAll=function(){Object.keys(this.overlayMap_).forEach(e=>{this.overlayMap_[e].destroy(),delete this.overlayMap_[e]})};var Y=X;const Q=function(e){this.autoRenderLoop_=null,this.map_=e.map,this.time_=e.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=a.default.getTransform(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;const t="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");const i=document.createAttribute("style");i.value=`${t}visibility:hidden;`,this.container_.setAttributeNode(i);let n=e.target||null;if(n)"string"==typeof n&&(n=document.getElementById(n)),n.appendChild(this.container_);else{const e=this.map_.getViewport().querySelector(".ol-overlaycontainer");e&&e.parentNode&&e.parentNode.insertBefore(this.container_,e)}if(this.isOverMap_=!n,this.isOverMap_&&e.stopOpenLayersEventsPropagation){const e=[l.default.EventType.CLICK,l.default.EventType.DBLCLICK,l.default.EventType.MOUSEDOWN,l.default.EventType.TOUCHSTART,l.default.EventType.MSPOINTERDOWN,u.a.POINTERDOWN,l.default.EventType.MOUSEWHEEL,l.default.EventType.WHEEL];for(let t=0,i=e.length;t<i;++t)l.default.listen(this.container_,e[t],l.default.Event.stopPropagation)}this.canvas_=document.createElement("CANVAS");const o=document.createAttribute("style");o.value=t,this.canvas_.setAttributeNode(o),h.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=h.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;const s=void 0!==e.sceneOptions?e.sceneOptions:{};s.canvas=this.canvas_,s.scene3DOnly=!0,this.scene_=new Cesium.Scene(s);const r=this.scene_.screenSpaceCameraController;r.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),r.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),r.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new y(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const c=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(c,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});const d=e.createSynchronizers?e.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new T(this.map_,this.scene_),new H(this.map_,this.scene_),new Y(this.map_,this.scene_)];this.handleResize_();for(let e=d.length-1;e>=0;--e)d[e].synchronize();if(this.isOverMap_){const e=this.canvas_.nextElementSibling;e&&(e.style.display="none")}this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,(new Cesium.EventHelper).add(this.scene_.postRender,Q.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1};Object.defineProperties(Q.prototype,{trackedFeature:{get:function(){return this.trackedFeature_},set:function(e){if(this.trackedFeature_!==e){const t=this.scene_;if(!e||!e.getGeometry())return this.needTrackedEntityUpdate_=!1,t.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,void t.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;const i=this.to4326Transform_,n=function(){const t=e.getGeometry();r.a.assertInstanceof(t,o.default);const n=t.getCoordinates(),s=i(n,void 0,n.length);return d.default.ol4326CoordinateToCesiumCartesian(s)},s={position:new Cesium.CallbackProperty((e,t)=>n(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(s)}}}}),Q.prototype.render_=function(){void 0!==this.renderId_&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),!this.enabled_&&!this.warmingUp_||this.blockCesiumRendering_||(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))},Q.prototype.onAnimationFrame_=function(e){this.renderId_=void 0;const t=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<t)return void this.render_();this.lastFrameTime_=e;const i=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(i),this.entityView_){const e=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(i,this.boundingSphereScratch_))}this.scene_.render(i),this.camera_.checkCameraChange(),this.render_()},Q.prototype.updateTrackedEntity_=function(){if(!this.needTrackedEntityUpdate_)return;const e=this.trackedEntity_,t=this.scene_,i=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(i===Cesium.BoundingSphereState.PENDING)return;t.screenSpaceCameraController.enableTilt=!1;const n=i!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;n&&(n.radius=1),this.entityView_=new Cesium.EntityView(e,t,t.mapProjection.ellipsoid),this.entityView_.update(this.time_(),n),this.needTrackedEntityUpdate_=!1},Q.prototype.handleResize_=function(){let e=this.canvas_.clientWidth,t=this.canvas_.clientHeight;if(0===e|0===t)return;if(e===this.canvasClientWidth_&&t===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let i=this.resolutionScale_;h.supportsImageRenderingPixelated()||(i*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=t,e*=i,t*=i,this.canvas_.width=e,this.canvas_.height=t,this.scene_.camera.frustum.aspectRatio=e/t},Q.prototype.getCamera=function(){return this.camera_},Q.prototype.getOlMap=function(){return this.map_},Q.prototype.getOlView=function(){const e=this.map_.getView();return r.a.assert(e),e},Q.prototype.getCesiumScene=function(){return this.scene_},Q.prototype.getDataSources=function(){return this.dataSourceCollection_},Q.prototype.getDataSourceDisplay=function(){return this.dataSourceDisplay_},Q.prototype.getEnabled=function(){return this.enabled_},Q.prototype.setEnabled=function(e){if(this.enabled_===e)return;let t;if(this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden",this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){(t=this.map_.getInteractions()).forEach(function(e,t,i){this.pausedInteractions_.push(e)},this),t.clear();const e=this.map_.getLayerGroup();e.getVisible()&&(this.hiddenRootGroup_=e,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay"),this.map_.getOverlayContainerStopEvent().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(t=this.map_.getInteractions(),this.pausedInteractions_.forEach(e=>{t.push(e)}),this.pausedInteractions_.length=0,this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.map_.getOverlayContainerStopEvent().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()},Q.prototype.warmUp=function(e,t){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const i=this.globe_.ellipsoid,n=this.scene_.camera,o=i.cartesianToCartographic(n.position);o.height<e&&(o.height=e,n.position=i.cartographicToCartesian(o)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},t)},Q.prototype.setBlockCesiumRendering=function(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())},Q.prototype.enableAutoRenderLoop=function(){this.autoRenderLoop_||(this.autoRenderLoop_=new m(this,!1))},Q.prototype.getAutoRenderLoop=function(){return this.autoRenderLoop_},Q.prototype.setResolutionScale=function(e){(e=Math.max(0,e))!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())},Q.prototype.setTargetFrameRate=function(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())},Q.prototype.throwOnUnitializedMap_=function(){const e=this.map_.getView(),t=e.getCenter();if(!e.isDef()||isNaN(t[0])||isNaN(t[1]))throw new Error(`The OpenLayers map is not properly initialized: ${t} / ${e.getResolution()}`)};var J=Q;t.default=class extends f.default{constructor(e,{map:t,cameraExtentInRadians:i}={}){super(),this.cesiumUrl_=e,this.map=t,this.cameraExtentInRadians=i||null,this.boundingSphere_,this.blockLimiter_=!1,this.promise_,this.ol3d,this.cesiumInitialTilt_=g.default.toRadians(50),this.fogDensity=1e-4,this.fogSSEFactor=25,this.minimumZoomDistance=2,this.maximumZoomDistance=1e7,this.limitCameraToBoundingSphereRatio=(e=>e>3e3?9:3)}load(){if(!this.promise_){const e=new n(this.cesiumUrl_);this.promise_=e.load().then(()=>this.onCesiumLoaded())}return this.promise_}onCesiumLoaded(){if(this.cameraExtentInRadians){const e=new Cesium.Rectangle(...this.cameraExtentInRadians);Cesium.Camera.DEFAULT_VIEW_RECTANGLE=e,this.boundingSphere_=Cesium.BoundingSphere.fromRectangle3D(e,Cesium.Ellipsoid.WGS84,300)}this.ol3d=this.instantiateOLCesium();const e=this.ol3d.getCesiumScene();return this.configureForUsability(e),this.configureForPerformance(e),this.dispatchEvent("load"),this.ol3d}instantiateOLCesium(){r.a.assert(this.map);const e=new J({map:this.map}),t=e.getCesiumScene(),i=new Cesium.CesiumTerrainProvider({url:"//assets.agi.com/stk-terrain/world"});return t.terrainProvider=i,e}configureForPerformance(e){const t=e.fog;t.enabled=!0,t.density=this.fogDensity,t.screenSpaceErrorFactor=this.fogSSEFactor}configureForUsability(e){const t=e.screenSpaceCameraController;t.minimumZoomDistance=this.minimumZoomDistance,t.maximumZoomDistance=this.maximumZoomDistance,e.globe.depthTestAgainstTerrain=!0,e.globe.baseColor=Cesium.Color.WHITE,e.backgroundColor=Cesium.Color.WHITE,this.boundingSphere_&&e.postRender.addEventListener(this.limitCameraToBoundingSphere.bind(this),e),this.ol3d.enableAutoRenderLoop()}limitCameraToBoundingSphere(){if(this.boundingSphere_&&!this.blockLimiter_){const e=this.ol3d.getCesiumScene().camera,t=e.position,i=Cesium.Cartographic.fromCartesian(t),n=this.limitCameraToBoundingSphereRatio(i.height);if(Cesium.Cartesian3.distance(this.boundingSphere_.center,t)>this.boundingSphere_.radius*n){if(!0===e.flying)return;{this.blockLimiter_=!0;const t=()=>this.blockLimiter_=!1;e.flyToBoundingSphere(this.boundingSphere_,{complete:t,cancel:t})}}}}toggle3d(){return this.load().then(e=>{const t=e.getEnabled(),i=e.getCesiumScene();return t?(r.a.assert(this.map),d.default.resetToNorthZenith(this.map,i).then(()=>{e.setEnabled(!1),this.dispatchEvent("toggle")})):(e.setEnabled(!0),this.dispatchEvent("toggle"),d.default.rotateAroundBottomCenter(i,this.cesiumInitialTilt_))})}set3dWithView(e,t,i,n,o){return this.load().then(s=>{const r=s.getEnabled(),a=s.getCesiumScene().camera,l=Cesium.Cartesian3.fromDegrees(e,t,i),u={heading:Cesium.Math.toRadians(n),pitch:Cesium.Math.toRadians(o),roll:0};r||(s.setEnabled(!0),this.dispatchEvent("toggle")),a.setView({destination:l,orientation:u})})}is3dEnabled(){return!!this.ol3d&&this.ol3d.getEnabled()}getHeading(){return this.map&&this.map.getView().getRotation()||0}getTiltOnGlobe(){const e=this.ol3d.getCesiumScene();return-d.default.computeSignedTiltAngleOnGlobe(e)}setHeading(e){const t=this.ol3d.getCesiumScene(),i=d.default.pickBottomPoint(t);i&&d.default.setHeadingUsingBottomCenter(t,e,i)}getOl3d(){return this.ol3d}getOlView(){const e=this.map.getView();return r.a.assert(e),e}getCesiumViewMatrix(){return this.ol3d.getCesiumScene().camera.viewMatrix}getCesiumScene(){return this.ol3d.getCesiumScene()}flyToRectangle(e,t=0){const i=this.getCesiumScene().camera,n=i.getRectangleCameraCoordinates(e),o=Cesium.Cartesian3.magnitude(n)+t;return Cesium.Cartesian3.normalize(n,n),Cesium.Cartesian3.multiplyByScalar(n,o,n),new Promise((e,t)=>{this.cameraExtentInRadians?i.flyTo({destination:n,complete:()=>e(),cancel:()=>t(),endTransform:Cesium.Matrix4.IDENTITY}):t()})}getCameraExtentRectangle(){if(this.cameraExtentInRadians)return new Cesium.Rectangle(...this.cameraExtentInRadians)}}},48:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(49);const s=function(e){const t=e||{};let i;i=void 0!==t.attributions?t.attributions:[s.ATTRIBUTION];const n=void 0!==t.crossOrigin?t.crossOrigin:"anonymous",r=void 0!==t.url?t.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";o.a.call(this,{attributions:i,cacheSize:t.cacheSize,crossOrigin:n,opaque:void 0===t.opaque||t.opaque,maxZoom:void 0!==t.maxZoom?t.maxZoom:19,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,url:r,wrapX:t.wrapX})};Object(n.inherits)(s,o.a),s.ATTRIBUTION='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.',t.default=s},49:function(e,t,i){"use strict";var n=i(0),o=i(42),s=i(71);const r=function(e){const t=e||{},i=void 0!==t.projection?t.projection:"EPSG:3857",n=void 0!==t.tileGrid?t.tileGrid:s.a.createXYZ({extent:s.a.extentFromProjection(i),maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});o.a.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,opaque:t.opaque,projection:i,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition})};Object(n.inherits)(r,o.a),t.a=r}},[398]);
//# sourceMappingURL=simple3d.min.js.map